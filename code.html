<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Jannie Leung, Lin Yu, Barrett Buhler, Nhat Chau, Isha Sharma">

<title>CHL5222 Group E Final Project Report</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="code_files/libs/clipboard/clipboard.min.js"></script>
<script src="code_files/libs/quarto-html/quarto.js"></script>
<script src="code_files/libs/quarto-html/popper.min.js"></script>
<script src="code_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="code_files/libs/quarto-html/anchor.min.js"></script>
<link href="code_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="code_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="code_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="code_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="code_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="code_files/libs/kePrint-0.0.1/kePrint.js"></script>
<link href="code_files/libs/lightable-0.0.1/lightable.css" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#part-1-exploratory-data-analysis" id="toc-part-1-exploratory-data-analysis" class="nav-link active" data-scroll-target="#part-1-exploratory-data-analysis">PART 1: Exploratory Data Analysis</a>
  <ul class="collapse">
  <li><a href="#table-1-summary-statistics" id="toc-table-1-summary-statistics" class="nav-link" data-scroll-target="#table-1-summary-statistics">Table 1: Summary Statistics</a></li>
  <li><a href="#table-2-summary-statistics-contd" id="toc-table-2-summary-statistics-contd" class="nav-link" data-scroll-target="#table-2-summary-statistics-contd">Table 2: Summary Statistics (cont’d)</a></li>
  <li><a href="#figure-1-averaged-vaccination-rates" id="toc-figure-1-averaged-vaccination-rates" class="nav-link" data-scroll-target="#figure-1-averaged-vaccination-rates">Figure 1: Averaged vaccination rates</a></li>
  <li><a href="#figure-2-averaged-vaccination-rates-contd" id="toc-figure-2-averaged-vaccination-rates-contd" class="nav-link" data-scroll-target="#figure-2-averaged-vaccination-rates-contd">Figure 2: Averaged vaccination rates (cont’d)</a></li>
  </ul></li>
  <li><a href="#part-2-model-and-diagnostics" id="toc-part-2-model-and-diagnostics" class="nav-link" data-scroll-target="#part-2-model-and-diagnostics">PART 2: Model and Diagnostics</a>
  <ul class="collapse">
  <li><a href="#part-2.1-overall-vaccination-rate" id="toc-part-2.1-overall-vaccination-rate" class="nav-link" data-scroll-target="#part-2.1-overall-vaccination-rate">PART 2.1 : overall vaccination rate</a>
  <ul class="collapse">
  <li><a href="#model-1-multi-level-linear-mixed-effects-model" id="toc-model-1-multi-level-linear-mixed-effects-model" class="nav-link" data-scroll-target="#model-1-multi-level-linear-mixed-effects-model">Model 1: Multi-level Linear Mixed Effects model</a></li>
  <li><a href="#table-3-three-level-fixed-effects-model-output" id="toc-table-3-three-level-fixed-effects-model-output" class="nav-link" data-scroll-target="#table-3-three-level-fixed-effects-model-output">Table 3: three-level fixed effects model output</a></li>
  <li><a href="#model-2-linear-regression-model" id="toc-model-2-linear-regression-model" class="nav-link" data-scroll-target="#model-2-linear-regression-model">Model 2: Linear regression model</a></li>
  <li><a href="#model-3-two-level-linear-mixed-effect-model" id="toc-model-3-two-level-linear-mixed-effect-model" class="nav-link" data-scroll-target="#model-3-two-level-linear-mixed-effect-model">Model 3: Two-level linear mixed effect model</a></li>
  <li><a href="#compare-model-1-model-2-model-3" id="toc-compare-model-1-model-2-model-3" class="nav-link" data-scroll-target="#compare-model-1-model-2-model-3">Compare Model 1, Model 2, Model 3</a></li>
  <li><a href="#check-model-diagnostics-of-model-1" id="toc-check-model-diagnostics-of-model-1" class="nav-link" data-scroll-target="#check-model-diagnostics-of-model-1">Check model diagnostics of Model 1</a></li>
  <li><a href="#table-4-intra-class-clustering" id="toc-table-4-intra-class-clustering" class="nav-link" data-scroll-target="#table-4-intra-class-clustering">Table 4: Intra-class clustering</a></li>
  </ul></li>
  <li><a href="#part-2.2-mmr-vaccination-rate" id="toc-part-2.2-mmr-vaccination-rate" class="nav-link" data-scroll-target="#part-2.2-mmr-vaccination-rate">PART 2.2: MMR vaccination rate</a>
  <ul class="collapse">
  <li><a href="#model-4-fit-linear-mixed-effects-model" id="toc-model-4-fit-linear-mixed-effects-model" class="nav-link" data-scroll-target="#model-4-fit-linear-mixed-effects-model">Model 4: Fit Linear Mixed Effects model</a></li>
  <li><a href="#table-3-three-level-fixed-effects-model-output-1" id="toc-table-3-three-level-fixed-effects-model-output-1" class="nav-link" data-scroll-target="#table-3-three-level-fixed-effects-model-output-1">Table 3: three-level fixed effects model output</a></li>
  <li><a href="#model-5-linear-regression-model-base-model" id="toc-model-5-linear-regression-model-base-model" class="nav-link" data-scroll-target="#model-5-linear-regression-model-base-model">Model 5: linear regression model (base model)</a></li>
  <li><a href="#model-6-two-level-linear-mixed-effect-model" id="toc-model-6-two-level-linear-mixed-effect-model" class="nav-link" data-scroll-target="#model-6-two-level-linear-mixed-effect-model">Model 6: two-level linear mixed effect model</a></li>
  <li><a href="#compare-model-4-model-5-and-model-6" id="toc-compare-model-4-model-5-and-model-6" class="nav-link" data-scroll-target="#compare-model-4-model-5-and-model-6">Compare Model 4, Model 5, and Model 6</a></li>
  <li><a href="#check-model-diagnostics-of-model-4" id="toc-check-model-diagnostics-of-model-4" class="nav-link" data-scroll-target="#check-model-diagnostics-of-model-4">Check model diagnostics of Model 4</a></li>
  <li><a href="#table-4-intra-class-correlation" id="toc-table-4-intra-class-correlation" class="nav-link" data-scroll-target="#table-4-intra-class-correlation">Table 4: intra-class correlation</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#part-3-supplementary-tables" id="toc-part-3-supplementary-tables" class="nav-link" data-scroll-target="#part-3-supplementary-tables">PART 3: Supplementary Tables</a>
  <ul class="collapse">
  <li><a href="#supplementary-table-a1-more-detailed-summary-statistics-by-state" id="toc-supplementary-table-a1-more-detailed-summary-statistics-by-state" class="nav-link" data-scroll-target="#supplementary-table-a1-more-detailed-summary-statistics-by-state">Supplementary Table A1: More detailed summary statistics by state</a></li>
  <li><a href="#supplementary-table-a2-aic-and-bic-to-compare-models" id="toc-supplementary-table-a2-aic-and-bic-to-compare-models" class="nav-link" data-scroll-target="#supplementary-table-a2-aic-and-bic-to-compare-models">Supplementary Table A2: AIC and BIC to compare models</a></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">CHL5222 Group E Final Project Report</h1>
<p class="subtitle lead">Association between public spending on education and school-aged vaccination coverage rates in the US</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Jannie Leung, Lin Yu, Barrett Buhler, Nhat Chau, Isha Sharma </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<p>A Description of the <code>data</code> folder:</p>
<ul>
<li><p>vaccine.csv is the original data we received;</p></li>
<li><p>us_states.rds is the US map data that we used to generate Figure 1.</p></li>
</ul>
<p>Other notes:</p>
<ul>
<li><p>We obtained the Electoral College results data from the National Archives. This data was then added to the analytical dataset in the code chunk named <code>electoral college</code>.</p></li>
<li><p>We outlined the approach for performing residual diagnostics on level-one residuals in the code chunks titled <code>stage one residual overall</code> and <code>stage one residual MMR</code>. owever, we were unable to obtain the results due to computational limitations arising from the large sample size.</p></li>
</ul>
<p>A summary of the R version and package information is listed below:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>R.version</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>               _                           
platform       x86_64-apple-darwin20       
arch           x86_64                      
os             darwin20                    
system         x86_64, darwin20            
status                                     
major          4                           
minor          3.1                         
year           2023                        
month          06                          
day            16                          
svn rev        84548                       
language       R                           
version.string R version 4.3.1 (2023-06-16)
nickname       Beagle Scouts               </code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sessionInfo</span>() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R version 4.3.1 (2023-06-16)
Platform: x86_64-apple-darwin20 (64-bit)
Running under: macOS Sonoma 14.1

Matrix products: default
BLAS:   /Library/Frameworks/R.framework/Versions/4.3-x86_64/Resources/lib/libRblas.0.dylib 
LAPACK: /Library/Frameworks/R.framework/Versions/4.3-x86_64/Resources/lib/libRlapack.dylib;  LAPACK version 3.11.0

locale:
[1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8

time zone: America/Toronto
tzcode source: internal

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     

loaded via a namespace (and not attached):
 [1] htmlwidgets_1.6.4 compiler_4.3.1    fastmap_1.2.0     cli_3.6.3        
 [5] tools_4.3.1       htmltools_0.5.8.1 rstudioapi_0.17.1 yaml_2.3.10      
 [9] rmarkdown_2.29    knitr_1.49        jsonlite_1.8.9    xfun_0.50        
[13] digest_0.6.37     rlang_1.1.4       evaluate_1.0.3   </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>tictoc<span class="sc">::</span><span class="fu">tic</span>()</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="do">## load R packages</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(here)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tinytex)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(PupillometryR)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DT)</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lme4)</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(car)</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(table1)</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tibble)</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tigris)</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggpubr)</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a><span class="co"># set report formatting</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>opts_knit<span class="sc">$</span><span class="fu">set</span>(<span class="at">root.dir =</span> <span class="fu">here</span>())</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>opts_chunk<span class="sc">$</span><span class="fu">set</span>(<span class="at">warning =</span> <span class="cn">FALSE</span>, <span class="at">message =</span> <span class="cn">FALSE</span>)</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_set</span>(<span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">12</span>)) <span class="co"># Use black/white theme and increase font size for all ggplot figures</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In this project, we consulted with the Stackoverflow and Datanovia websites for data analysis.</p>
<section id="part-1-exploratory-data-analysis" class="level1">
<h1>PART 1: Exploratory Data Analysis</h1>
<p>We cleaned the original data before model building.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="do">## load dataset</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>vaccine <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/vaccine.csv"</span>)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="do">## clean dataset</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>vaccine_dat <span class="ot">&lt;-</span> vaccine <span class="sc">%&gt;%</span> </span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># recode vaccination coverage rates with -1 as missing</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">overall_recode =</span> <span class="fu">ifelse</span>(overall <span class="sc">==</span> <span class="sc">-</span><span class="dv">1</span>, <span class="cn">NA</span>, overall),</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">mmr_recode =</span> <span class="fu">ifelse</span>(mmr <span class="sc">==</span> <span class="sc">-</span><span class="dv">1</span>, <span class="cn">NA</span>, mmr)) <span class="sc">%&gt;%</span>   </span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># recode missing or 2017 school year as 2017-2018 (as per dataset description)</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year_recode =</span> <span class="fu">case_when</span>(</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>    year <span class="sc">==</span> <span class="st">"null"</span> <span class="sc">~</span> <span class="st">"2017-18"</span>,</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>    year <span class="sc">==</span> <span class="st">"2017"</span> <span class="sc">~</span> <span class="st">"2017-18"</span>,</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> year)) <span class="sc">%&gt;%</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># create state spending per pupil variable (in US$1million)</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">spend_person =</span> <span class="fu">round</span>(statespending2016<span class="sc">/</span>schagepop2016<span class="sc">/</span><span class="dv">1000</span>, <span class="dv">2</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a> <span class="co"># clean county name</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">county =</span> <span class="fu">case_when</span>(</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>    county <span class="sc">==</span> <span class="st">"State Of Illinois"</span> <span class="sc">~</span> <span class="cn">NA_character_</span>,</span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>    county <span class="sc">==</span> <span class="st">"BLAINE"</span> <span class="sc">~</span> <span class="st">"Blaine"</span>,</span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>    county <span class="sc">==</span> <span class="st">"ADA"</span> <span class="sc">~</span> <span class="st">"Ada"</span>,</span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>    county <span class="sc">==</span> <span class="st">"#N/A"</span> <span class="sc">~</span> <span class="cn">NA_character_</span>,</span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>    county <span class="sc">==</span> <span class="st">"Oklahoma/Tulsa"</span> <span class="sc">~</span> <span class="st">"Oklahoma"</span>,</span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>    county <span class="sc">==</span> <span class="st">"Walwroth"</span> <span class="sc">~</span> <span class="st">"Walworth"</span>,</span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>    county <span class="sc">==</span> <span class="st">"adams"</span> <span class="sc">~</span> <span class="st">"Adams"</span>,</span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>    county <span class="sc">==</span> <span class="st">"Colorado BOCS"</span> <span class="sc">~</span> <span class="st">"Denver"</span>,</span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>    county <span class="sc">==</span> <span class="st">"New Hampshire"</span> <span class="sc">~</span> <span class="cn">NA_character_</span>,</span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> county)) <span class="sc">%&gt;%</span></span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>  <span class="co"># standardize county and state with uppercase</span></span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">county =</span> <span class="fu">toupper</span>(county)) <span class="sc">%&gt;%</span></span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">state =</span> <span class="fu">toupper</span>(state)) <span class="sc">%&gt;%</span></span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add state political electoral college as covariate</span></span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">state_political_vote =</span> <span class="fu">case_when</span>(</span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a>    state<span class="sc">==</span><span class="st">"ARIZONA"</span> <span class="sc">~</span> <span class="st">"Swing State"</span>,</span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a>    state<span class="sc">==</span><span class="st">"ARKANSAS"</span> <span class="sc">~</span> <span class="st">"Republican Party"</span>,</span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a>    state<span class="sc">==</span><span class="st">"CALIFORNIA"</span> <span class="sc">~</span> <span class="st">"Democratic Party"</span>,  </span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a>    state<span class="sc">==</span><span class="st">"COLORADO"</span> <span class="sc">~</span> <span class="st">"Democratic Party"</span>,     </span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a>    state<span class="sc">==</span><span class="st">"CONNECTICUT"</span> <span class="sc">~</span> <span class="st">"Democratic Party"</span>, </span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a>    state<span class="sc">==</span><span class="st">"FLORIDA"</span> <span class="sc">~</span> <span class="st">"Swing State"</span>,      </span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a>    state<span class="sc">==</span><span class="st">"IDAHO"</span> <span class="sc">~</span> <span class="st">"Republican Party"</span>,        </span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a>    state<span class="sc">==</span><span class="st">"ILLINOIS"</span> <span class="sc">~</span> <span class="st">"Democratic Party"</span>,</span>
<span id="cb6-48"><a href="#cb6-48" aria-hidden="true" tabindex="-1"></a>    state<span class="sc">==</span><span class="st">"IOWA"</span> <span class="sc">~</span> <span class="st">"Republican Party"</span>,         </span>
<span id="cb6-49"><a href="#cb6-49" aria-hidden="true" tabindex="-1"></a>    state<span class="sc">==</span><span class="st">"MAINE"</span> <span class="sc">~</span> <span class="st">"Swing State"</span>,  </span>
<span id="cb6-50"><a href="#cb6-50" aria-hidden="true" tabindex="-1"></a>    state<span class="sc">==</span><span class="st">"MASSACHUSETTS"</span> <span class="sc">~</span> <span class="st">"Democratic Party"</span>, </span>
<span id="cb6-51"><a href="#cb6-51" aria-hidden="true" tabindex="-1"></a>    state<span class="sc">==</span><span class="st">"MICHIGAN"</span> <span class="sc">~</span> <span class="st">"Republican Party"</span>, </span>
<span id="cb6-52"><a href="#cb6-52" aria-hidden="true" tabindex="-1"></a>    state<span class="sc">==</span><span class="st">"MINNESOTA"</span> <span class="sc">~</span> <span class="st">"Swing State"</span>, </span>
<span id="cb6-53"><a href="#cb6-53" aria-hidden="true" tabindex="-1"></a>    state<span class="sc">==</span><span class="st">"MISSOURI"</span> <span class="sc">~</span> <span class="st">"Republican Party"</span>, </span>
<span id="cb6-54"><a href="#cb6-54" aria-hidden="true" tabindex="-1"></a>    state<span class="sc">==</span><span class="st">"MONTANA"</span> <span class="sc">~</span> <span class="st">"Republican Party"</span>,     </span>
<span id="cb6-55"><a href="#cb6-55" aria-hidden="true" tabindex="-1"></a>    state<span class="sc">==</span><span class="st">"NEW JERSEY"</span> <span class="sc">~</span> <span class="st">"Democratic Party"</span>,  </span>
<span id="cb6-56"><a href="#cb6-56" aria-hidden="true" tabindex="-1"></a>    state<span class="sc">==</span><span class="st">"NEW YORK"</span> <span class="sc">~</span> <span class="st">"Democratic Party"</span>, </span>
<span id="cb6-57"><a href="#cb6-57" aria-hidden="true" tabindex="-1"></a>    state<span class="sc">==</span><span class="st">"NORTH CAROLINA"</span> <span class="sc">~</span> <span class="st">"Swing State"</span>, </span>
<span id="cb6-58"><a href="#cb6-58" aria-hidden="true" tabindex="-1"></a>    state<span class="sc">==</span><span class="st">"NORTH DAKOTA"</span> <span class="sc">~</span> <span class="st">"Republican Party"</span>, </span>
<span id="cb6-59"><a href="#cb6-59" aria-hidden="true" tabindex="-1"></a>    state<span class="sc">==</span><span class="st">"OHIO"</span> <span class="sc">~</span> <span class="st">"Republican Party"</span>,         </span>
<span id="cb6-60"><a href="#cb6-60" aria-hidden="true" tabindex="-1"></a>    state<span class="sc">==</span><span class="st">"OKLAHOMA"</span> <span class="sc">~</span> <span class="st">"Republican Party"</span>,     </span>
<span id="cb6-61"><a href="#cb6-61" aria-hidden="true" tabindex="-1"></a>    state<span class="sc">==</span><span class="st">"OREGON"</span> <span class="sc">~</span> <span class="st">"Democratic Party"</span>,       </span>
<span id="cb6-62"><a href="#cb6-62" aria-hidden="true" tabindex="-1"></a>    state<span class="sc">==</span><span class="st">"PENNSYLVANIA"</span> <span class="sc">~</span> <span class="st">"Swing State"</span>, </span>
<span id="cb6-63"><a href="#cb6-63" aria-hidden="true" tabindex="-1"></a>    state<span class="sc">==</span><span class="st">"RHODE ISLAND"</span> <span class="sc">~</span> <span class="st">"Democratic Party"</span>, </span>
<span id="cb6-64"><a href="#cb6-64" aria-hidden="true" tabindex="-1"></a>    state<span class="sc">==</span><span class="st">"SOUTH DAKOTA"</span> <span class="sc">~</span> <span class="st">"Republican Party"</span>, </span>
<span id="cb6-65"><a href="#cb6-65" aria-hidden="true" tabindex="-1"></a>    state<span class="sc">==</span><span class="st">"TENNESSEE"</span> <span class="sc">~</span> <span class="st">"Republican Party"</span>,    </span>
<span id="cb6-66"><a href="#cb6-66" aria-hidden="true" tabindex="-1"></a>    state<span class="sc">==</span><span class="st">"TEXAS"</span> <span class="sc">~</span> <span class="st">"Republican Party"</span>, </span>
<span id="cb6-67"><a href="#cb6-67" aria-hidden="true" tabindex="-1"></a>    state<span class="sc">==</span><span class="st">"UTAH"</span> <span class="sc">~</span> <span class="st">"Republican Party"</span>, </span>
<span id="cb6-68"><a href="#cb6-68" aria-hidden="true" tabindex="-1"></a>    state<span class="sc">==</span><span class="st">"VERMONT"</span> <span class="sc">~</span> <span class="st">"Democratic Party"</span>,      </span>
<span id="cb6-69"><a href="#cb6-69" aria-hidden="true" tabindex="-1"></a>    state<span class="sc">==</span><span class="st">"VIRGINIA"</span> <span class="sc">~</span> <span class="st">"Democratic Party"</span>,     </span>
<span id="cb6-70"><a href="#cb6-70" aria-hidden="true" tabindex="-1"></a>    state<span class="sc">==</span><span class="st">"WASHINGTON"</span> <span class="sc">~</span> <span class="st">"Democratic Party"</span>,  </span>
<span id="cb6-71"><a href="#cb6-71" aria-hidden="true" tabindex="-1"></a>    state<span class="sc">==</span><span class="st">"WISCONSIN"</span> <span class="sc">~</span> <span class="st">"Swing State"</span></span>
<span id="cb6-72"><a href="#cb6-72" aria-hidden="true" tabindex="-1"></a>    )) <span class="sc">%&gt;%</span></span>
<span id="cb6-73"><a href="#cb6-73" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-74"><a href="#cb6-74" aria-hidden="true" tabindex="-1"></a>    <span class="co"># assign Swing State as reference category</span></span>
<span id="cb6-75"><a href="#cb6-75" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">state_political_vote =</span> <span class="fu">factor</span>(state_political_vote, <span class="at">levels =</span> <span class="fu">c</span>(</span>
<span id="cb6-76"><a href="#cb6-76" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Swing State"</span>,</span>
<span id="cb6-77"><a href="#cb6-77" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Democratic Party"</span>,</span>
<span id="cb6-78"><a href="#cb6-78" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Republican Party"</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb6-79"><a href="#cb6-79" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-80"><a href="#cb6-80" aria-hidden="true" tabindex="-1"></a>  <span class="co"># create unique school id</span></span>
<span id="cb6-81"><a href="#cb6-81" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(state, county, city, name) <span class="sc">%&gt;%</span></span>
<span id="cb6-82"><a href="#cb6-82" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">school_id =</span> <span class="fu">row_number</span>())</span>
<span id="cb6-83"><a href="#cb6-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-84"><a href="#cb6-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-85"><a href="#cb6-85" aria-hidden="true" tabindex="-1"></a><span class="do">## create dataset for schools with overall vaccination rates</span></span>
<span id="cb6-86"><a href="#cb6-86" aria-hidden="true" tabindex="-1"></a>vaccine_overall <span class="ot">&lt;-</span> vaccine_dat <span class="sc">%&gt;%</span></span>
<span id="cb6-87"><a href="#cb6-87" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(overall_recode))</span>
<span id="cb6-88"><a href="#cb6-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-89"><a href="#cb6-89" aria-hidden="true" tabindex="-1"></a><span class="do">## create dataset for schools with MMR vaccination rates</span></span>
<span id="cb6-90"><a href="#cb6-90" aria-hidden="true" tabindex="-1"></a>vaccine_mmr <span class="ot">&lt;-</span> vaccine_dat <span class="sc">%&gt;%</span></span>
<span id="cb6-91"><a href="#cb6-91" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(mmr_recode))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="table-1-summary-statistics" class="level2">
<h2 class="anchored" data-anchor-id="table-1-summary-statistics">Table 1: Summary Statistics</h2>
<p>We first generated a descriptive summary of the data by outcome variable</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>state_count_mmr <span class="ot">&lt;-</span> vaccine_dat <span class="sc">%&gt;%</span> </span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(mmr_recode)) <span class="sc">%&gt;%</span> </span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n_states =</span> <span class="fu">n_distinct</span>(state))</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>state_count_overall <span class="ot">&lt;-</span> vaccine_dat <span class="sc">%&gt;%</span> </span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(overall_recode)) <span class="sc">%&gt;%</span> </span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n_states =</span> <span class="fu">n_distinct</span>(state))</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>county_stats_mmr <span class="ot">&lt;-</span> vaccine_dat <span class="sc">%&gt;%</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(mmr_recode)) <span class="sc">%&gt;%</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(state) <span class="sc">%&gt;%</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n_counties =</span> <span class="fu">n_distinct</span>(county)) <span class="sc">%&gt;%</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">total =</span> <span class="fu">sum</span>(n_counties),</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">median =</span> <span class="fu">median</span>(n_counties),</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">min =</span> <span class="fu">min</span>(n_counties),</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">max =</span> <span class="fu">max</span>(n_counties)</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>county_stats_overall <span class="ot">&lt;-</span> vaccine_dat <span class="sc">%&gt;%</span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(overall_recode)) <span class="sc">%&gt;%</span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(state) <span class="sc">%&gt;%</span></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n_counties =</span> <span class="fu">n_distinct</span>(county)) <span class="sc">%&gt;%</span></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">total =</span> <span class="fu">sum</span>(n_counties),</span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">median =</span> <span class="fu">median</span>(n_counties),</span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">min =</span> <span class="fu">min</span>(n_counties),</span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">max =</span> <span class="fu">max</span>(n_counties)</span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>school_stats_mmr <span class="ot">&lt;-</span> vaccine_dat <span class="sc">%&gt;%</span></span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(mmr_recode)) <span class="sc">%&gt;%</span></span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(state) <span class="sc">%&gt;%</span></span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year_recode) <span class="sc">%&gt;%</span> </span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n_schools =</span> <span class="fu">n_distinct</span>(name)) <span class="sc">%&gt;%</span></span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">total =</span> <span class="fu">sum</span>(n_schools),</span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">median =</span> <span class="fu">median</span>(n_schools),</span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">min =</span> <span class="fu">min</span>(n_schools),</span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">max =</span> <span class="fu">max</span>(n_schools)</span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a>school_stats_overall <span class="ot">&lt;-</span> vaccine_dat <span class="sc">%&gt;%</span></span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(overall_recode)) <span class="sc">%&gt;%</span></span>
<span id="cb7-44"><a href="#cb7-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(state) <span class="sc">%&gt;%</span></span>
<span id="cb7-45"><a href="#cb7-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n_schools =</span> <span class="fu">n_distinct</span>(name)) <span class="sc">%&gt;%</span></span>
<span id="cb7-46"><a href="#cb7-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb7-47"><a href="#cb7-47" aria-hidden="true" tabindex="-1"></a>    <span class="at">total =</span> <span class="fu">sum</span>(n_schools),</span>
<span id="cb7-48"><a href="#cb7-48" aria-hidden="true" tabindex="-1"></a>    <span class="at">median =</span> <span class="fu">median</span>(n_schools),</span>
<span id="cb7-49"><a href="#cb7-49" aria-hidden="true" tabindex="-1"></a>    <span class="at">min =</span> <span class="fu">min</span>(n_schools),</span>
<span id="cb7-50"><a href="#cb7-50" aria-hidden="true" tabindex="-1"></a>    <span class="at">max =</span> <span class="fu">max</span>(n_schools)</span>
<span id="cb7-51"><a href="#cb7-51" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb7-52"><a href="#cb7-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-53"><a href="#cb7-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-54"><a href="#cb7-54" aria-hidden="true" tabindex="-1"></a>spending_mmr <span class="ot">&lt;-</span> vaccine_dat <span class="sc">%&gt;%</span></span>
<span id="cb7-55"><a href="#cb7-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(mmr_recode)) <span class="sc">%&gt;%</span> </span>
<span id="cb7-56"><a href="#cb7-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(state) <span class="sc">%&gt;%</span> </span>
<span id="cb7-57"><a href="#cb7-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">spend =</span> <span class="fu">unique</span>(spend_person)) <span class="sc">%&gt;%</span> </span>
<span id="cb7-58"><a href="#cb7-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb7-59"><a href="#cb7-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_spend_thousand =</span> <span class="fu">round</span>(<span class="fu">mean</span>(spend, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="dv">2</span>),</span>
<span id="cb7-60"><a href="#cb7-60" aria-hidden="true" tabindex="-1"></a>            <span class="at">sd_spend_thousand =</span> <span class="fu">round</span>(<span class="fu">sd</span>(spend, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="dv">2</span>))</span>
<span id="cb7-61"><a href="#cb7-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-62"><a href="#cb7-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-63"><a href="#cb7-63" aria-hidden="true" tabindex="-1"></a>spending_overall <span class="ot">&lt;-</span> vaccine_dat <span class="sc">%&gt;%</span></span>
<span id="cb7-64"><a href="#cb7-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(overall_recode)) <span class="sc">%&gt;%</span> </span>
<span id="cb7-65"><a href="#cb7-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(state) <span class="sc">%&gt;%</span> </span>
<span id="cb7-66"><a href="#cb7-66" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">spend =</span> <span class="fu">unique</span>(spend_person)) <span class="sc">%&gt;%</span> </span>
<span id="cb7-67"><a href="#cb7-67" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb7-68"><a href="#cb7-68" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_spend_thousand =</span> <span class="fu">round</span>(<span class="fu">mean</span>(spend, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="dv">2</span>),</span>
<span id="cb7-69"><a href="#cb7-69" aria-hidden="true" tabindex="-1"></a>            <span class="at">sd_spend_thousand =</span> <span class="fu">round</span>(<span class="fu">sd</span>(spend, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="dv">2</span>))</span>
<span id="cb7-70"><a href="#cb7-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-71"><a href="#cb7-71" aria-hidden="true" tabindex="-1"></a>mean_mmr <span class="ot">&lt;-</span> vaccine_dat <span class="sc">%&gt;%</span></span>
<span id="cb7-72"><a href="#cb7-72" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(mmr_recode)) <span class="sc">%&gt;%</span></span>
<span id="cb7-73"><a href="#cb7-73" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_mmr =</span> <span class="fu">round</span>(<span class="fu">mean</span>(mmr_recode, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="dv">1</span>),</span>
<span id="cb7-74"><a href="#cb7-74" aria-hidden="true" tabindex="-1"></a>            <span class="at">sd_mmr =</span> <span class="fu">round</span>(<span class="fu">sd</span>(mmr_recode, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="dv">1</span>))</span>
<span id="cb7-75"><a href="#cb7-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-76"><a href="#cb7-76" aria-hidden="true" tabindex="-1"></a>mean_overall <span class="ot">&lt;-</span> vaccine_dat <span class="sc">%&gt;%</span></span>
<span id="cb7-77"><a href="#cb7-77" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(overall_recode)) <span class="sc">%&gt;%</span></span>
<span id="cb7-78"><a href="#cb7-78" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_overall =</span> <span class="fu">round</span>(<span class="fu">mean</span>(overall_recode, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="dv">2</span>),</span>
<span id="cb7-79"><a href="#cb7-79" aria-hidden="true" tabindex="-1"></a>            <span class="at">sd_overall =</span> <span class="fu">round</span>(<span class="fu">sd</span>(overall_recode, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="dv">2</span>))</span>
<span id="cb7-80"><a href="#cb7-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-81"><a href="#cb7-81" aria-hidden="true" tabindex="-1"></a>summary_table <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb7-82"><a href="#cb7-82" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">Outcome Variable</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"MMR"</span>, <span class="st">"Overall"</span>),</span>
<span id="cb7-83"><a href="#cb7-83" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">State (Count)</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">c</span>(</span>
<span id="cb7-84"><a href="#cb7-84" aria-hidden="true" tabindex="-1"></a>    <span class="fu">n_distinct</span>(vaccine_dat<span class="sc">$</span>state[<span class="sc">!</span><span class="fu">is.na</span>(vaccine_dat<span class="sc">$</span>mmr_recode)]),</span>
<span id="cb7-85"><a href="#cb7-85" aria-hidden="true" tabindex="-1"></a>    <span class="fu">n_distinct</span>(vaccine_dat<span class="sc">$</span>state[<span class="sc">!</span><span class="fu">is.na</span>(vaccine_dat<span class="sc">$</span>overall_recode)])</span>
<span id="cb7-86"><a href="#cb7-86" aria-hidden="true" tabindex="-1"></a>),</span>
<span id="cb7-87"><a href="#cb7-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-88"><a href="#cb7-88" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">County Count (Sum)</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">c</span>(</span>
<span id="cb7-89"><a href="#cb7-89" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste</span>(county_stats_mmr<span class="sc">$</span>total),</span>
<span id="cb7-90"><a href="#cb7-90" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste</span>(county_stats_overall<span class="sc">$</span>total)</span>
<span id="cb7-91"><a href="#cb7-91" aria-hidden="true" tabindex="-1"></a>),</span>
<span id="cb7-92"><a href="#cb7-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-93"><a href="#cb7-93" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">Median County per State (Min, Max)</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">c</span>(</span>
<span id="cb7-94"><a href="#cb7-94" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste</span>(county_stats_mmr<span class="sc">$</span>median, </span>
<span id="cb7-95"><a href="#cb7-95" aria-hidden="true" tabindex="-1"></a>        <span class="st">"["</span>, county_stats_mmr<span class="sc">$</span>min, <span class="st">","</span>, county_stats_mmr<span class="sc">$</span>max, <span class="st">"]"</span>),</span>
<span id="cb7-96"><a href="#cb7-96" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste</span>(county_stats_overall<span class="sc">$</span>median, </span>
<span id="cb7-97"><a href="#cb7-97" aria-hidden="true" tabindex="-1"></a>        <span class="st">"["</span>, county_stats_overall<span class="sc">$</span>min, <span class="st">","</span>, county_stats_overall<span class="sc">$</span>max, <span class="st">"]"</span>)</span>
<span id="cb7-98"><a href="#cb7-98" aria-hidden="true" tabindex="-1"></a>),</span>
<span id="cb7-99"><a href="#cb7-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-100"><a href="#cb7-100" aria-hidden="true" tabindex="-1"></a><span class="st">`</span><span class="at">School Count (Sum)</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">c</span>(</span>
<span id="cb7-101"><a href="#cb7-101" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste</span>(school_stats_mmr<span class="sc">$</span>total),</span>
<span id="cb7-102"><a href="#cb7-102" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste</span>(school_stats_overall<span class="sc">$</span>total)</span>
<span id="cb7-103"><a href="#cb7-103" aria-hidden="true" tabindex="-1"></a>),</span>
<span id="cb7-104"><a href="#cb7-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-105"><a href="#cb7-105" aria-hidden="true" tabindex="-1"></a> <span class="st">`</span><span class="at">Median School per State (Min, Max)</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">c</span>(</span>
<span id="cb7-106"><a href="#cb7-106" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste</span>(school_stats_mmr<span class="sc">$</span>median, </span>
<span id="cb7-107"><a href="#cb7-107" aria-hidden="true" tabindex="-1"></a>        <span class="st">"["</span>, school_stats_mmr<span class="sc">$</span>min, <span class="st">","</span>, school_stats_mmr<span class="sc">$</span>max, <span class="st">"]"</span>),</span>
<span id="cb7-108"><a href="#cb7-108" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste</span>(school_stats_overall<span class="sc">$</span>median, </span>
<span id="cb7-109"><a href="#cb7-109" aria-hidden="true" tabindex="-1"></a>        <span class="st">"["</span>, school_stats_overall<span class="sc">$</span>min, <span class="st">","</span>, school_stats_overall<span class="sc">$</span>max, <span class="st">"]"</span>)</span>
<span id="cb7-110"><a href="#cb7-110" aria-hidden="true" tabindex="-1"></a>),</span>
<span id="cb7-111"><a href="#cb7-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-112"><a href="#cb7-112" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">Average Spending per Person in $1000 USD</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">c</span>(</span>
<span id="cb7-113"><a href="#cb7-113" aria-hidden="true" tabindex="-1"></a>    <span class="fu">paste</span>(spending_mmr<span class="sc">$</span>mean_spend_thousand, <span class="st">"("</span>, spending_mmr<span class="sc">$</span>sd_spend_thousand, <span class="st">")"</span>),</span>
<span id="cb7-114"><a href="#cb7-114" aria-hidden="true" tabindex="-1"></a>    <span class="fu">paste</span>(spending_overall<span class="sc">$</span>mean_spend_thousand, <span class="st">"("</span>, spending_overall<span class="sc">$</span>sd_spend_thousand, <span class="st">")"</span>)</span>
<span id="cb7-115"><a href="#cb7-115" aria-hidden="true" tabindex="-1"></a>),</span>
<span id="cb7-116"><a href="#cb7-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-117"><a href="#cb7-117" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">Schools in 2017–18</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">c</span>(</span>
<span id="cb7-118"><a href="#cb7-118" aria-hidden="true" tabindex="-1"></a>    <span class="fu">table</span>(vaccine_dat<span class="sc">$</span>year_recode[<span class="sc">!</span><span class="fu">is.na</span>(vaccine_dat<span class="sc">$</span>mmr_recode)])[<span class="st">"2017-18"</span>],</span>
<span id="cb7-119"><a href="#cb7-119" aria-hidden="true" tabindex="-1"></a>    <span class="fu">table</span>(vaccine_dat<span class="sc">$</span>year_recode[<span class="sc">!</span><span class="fu">is.na</span>(vaccine_dat<span class="sc">$</span>overall_recode)])[<span class="st">"2017-18"</span>]</span>
<span id="cb7-120"><a href="#cb7-120" aria-hidden="true" tabindex="-1"></a>),</span>
<span id="cb7-121"><a href="#cb7-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-122"><a href="#cb7-122" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">Schools in 2018–19</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">c</span>(</span>
<span id="cb7-123"><a href="#cb7-123" aria-hidden="true" tabindex="-1"></a>    <span class="fu">table</span>(vaccine_dat<span class="sc">$</span>year_recode[<span class="sc">!</span><span class="fu">is.na</span>(vaccine_dat<span class="sc">$</span>mmr_recode)])[<span class="st">"2018-19"</span>],</span>
<span id="cb7-124"><a href="#cb7-124" aria-hidden="true" tabindex="-1"></a>    <span class="fu">table</span>(vaccine_dat<span class="sc">$</span>year_recode[<span class="sc">!</span><span class="fu">is.na</span>(vaccine_dat<span class="sc">$</span>overall_recode)])[<span class="st">"2018-19"</span>]</span>
<span id="cb7-125"><a href="#cb7-125" aria-hidden="true" tabindex="-1"></a>),</span>
<span id="cb7-126"><a href="#cb7-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-127"><a href="#cb7-127" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">Mean Vaccination Rate (%)</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">c</span>(</span>
<span id="cb7-128"><a href="#cb7-128" aria-hidden="true" tabindex="-1"></a>    <span class="fu">paste</span>(mean_mmr<span class="sc">$</span>mean_mmr, <span class="st">"("</span>, mean_mmr<span class="sc">$</span>sd_mmr, <span class="st">")"</span>),</span>
<span id="cb7-129"><a href="#cb7-129" aria-hidden="true" tabindex="-1"></a>    <span class="fu">paste</span>(mean_overall<span class="sc">$</span>mean_overall, <span class="st">"("</span>, mean_overall<span class="sc">$</span>sd_overall, <span class="st">")"</span>)</span>
<span id="cb7-130"><a href="#cb7-130" aria-hidden="true" tabindex="-1"></a>))</span>
<span id="cb7-131"><a href="#cb7-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-132"><a href="#cb7-132" aria-hidden="true" tabindex="-1"></a>summary_table <span class="sc">%&gt;%</span></span>
<span id="cb7-133"><a href="#cb7-133" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">format =</span> <span class="st">"html"</span>, <span class="at">escape =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb7-134"><a href="#cb7-134" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">full_width =</span> <span class="cn">FALSE</span>, <span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>, <span class="st">"condensed"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="tbl-summary" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-summary-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;1: Table 1. Descriptive summary of variables by outcome
</figcaption>
<div aria-describedby="tbl-summary-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="table table-striped table-hover table-condensed do-not-create-environment cell caption-top table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Outcome Variable</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">State (Count)</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">County Count (Sum)</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Median County per State (Min, Max)</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">School Count (Sum)</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Median School per State (Min, Max)</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Average Spending per Person in $1000 USD</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Schools in 2017–18</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Schools in 2018–19</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Mean Vaccination Rate (%)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">MMR</td>
<td style="text-align: right;">21</td>
<td style="text-align: left;">901</td>
<td style="text-align: left;">38 [ 1 , 103 ]</td>
<td style="text-align: left;">23745</td>
<td style="text-align: left;">11872.5 [ 9776 , 13969 ]</td>
<td style="text-align: left;">10.9 ( 3.37 )</td>
<td style="text-align: right;">11226</td>
<td style="text-align: right;">17098</td>
<td style="text-align: left;">94.3 ( 9.3 )</td>
</tr>
<tr class="even">
<td style="text-align: left;">Overall</td>
<td style="text-align: right;">17</td>
<td style="text-align: left;">1022</td>
<td style="text-align: left;">64 [ 1 , 130 ]</td>
<td style="text-align: left;">23865</td>
<td style="text-align: left;">1217 [ 215 , 5481 ]</td>
<td style="text-align: left;">10.34 ( 3.24 )</td>
<td style="text-align: right;">5459</td>
<td style="text-align: right;">20775</td>
<td style="text-align: left;">92 ( 10.58 )</td>
</tr>
</tbody>
</table>


</div>
</div>
</figure>
</div>
</div>
</section>
<section id="table-2-summary-statistics-contd" class="level2">
<h2 class="anchored" data-anchor-id="table-2-summary-statistics-contd">Table 2: Summary Statistics (cont’d)</h2>
<p>We also described the state electoral college results in 2016</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="do">## summarize count and percent electoral college votes by state for MMR outcome</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>pol_vote_mmr <span class="ot">&lt;-</span> vaccine_mmr <span class="sc">%&gt;%</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(state, state_political_vote) <span class="sc">%&gt;%</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">%&gt;%</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n_states =</span> <span class="fu">n_distinct</span>(state)) <span class="sc">%&gt;%</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(state_political_vote) <span class="sc">%&gt;%</span> </span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n_state_vote_mmr =</span> <span class="fu">n</span>(),</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">perc_state_vote_mmr =</span> <span class="fu">round</span>(n_state_vote_mmr <span class="sc">/</span> n_states<span class="sc">*</span><span class="dv">100</span>,<span class="dv">2</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">%&gt;%</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">state_vote_mmr =</span> <span class="fu">paste0</span>(n_state_vote_mmr, <span class="st">" ("</span>, perc_state_vote_mmr, <span class="st">"%)"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(state_political_vote, state_vote_mmr)</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a><span class="do">## summarize count and percent electoral college votes by state for overall outcome</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>pol_vote_overall <span class="ot">&lt;-</span> vaccine_overall <span class="sc">%&gt;%</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(state, state_political_vote) <span class="sc">%&gt;%</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">%&gt;%</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n_states =</span> <span class="fu">n_distinct</span>(state)) <span class="sc">%&gt;%</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(state_political_vote) <span class="sc">%&gt;%</span> </span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n_state_vote =</span> <span class="fu">n</span>(),</span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>            <span class="at">perc_state_vote =</span> <span class="fu">round</span>(n_state_vote <span class="sc">/</span> n_states<span class="sc">*</span><span class="dv">100</span>,<span class="dv">2</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">%&gt;%</span></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">state_vote =</span> <span class="fu">paste0</span>(n_state_vote, <span class="st">" ("</span>, perc_state_vote, <span class="st">"%)"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(state_political_vote, state_vote)</span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a><span class="do">## create final table</span></span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>pol_vote_table <span class="ot">&lt;-</span> pol_vote_mmr <span class="sc">%&gt;%</span></span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(pol_vote_overall, <span class="at">by =</span> <span class="st">"state_political_vote"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">state_political_vote =</span> <span class="fu">as.character</span>(state_political_vote)) <span class="sc">%&gt;%</span></span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(state_political_vote) <span class="sc">%&gt;%</span></span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"Political party"</span>,</span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"MMR Vaccination: n (%) states"</span>,</span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"Overall Vaccination: n (%) states"</span>),</span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a>        <span class="at">format =</span> <span class="st">"html"</span>, <span class="at">escape =</span> <span class="cn">FALSE</span>) </span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a>pol_vote_table</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<caption>Table 2. Vaccination rates by political party</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Political party</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">MMR Vaccination: n (%) states</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Overall Vaccination: n (%) states</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Democratic Party</td>
<td style="text-align: left;">9 (42.86%)</td>
<td style="text-align: left;">8 (47.06%)</td>
</tr>
<tr class="even">
<td style="text-align: left;">Republican Party</td>
<td style="text-align: left;">8 (38.1%)</td>
<td style="text-align: left;">6 (35.29%)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Swing State</td>
<td style="text-align: left;">4 (19.05%)</td>
<td style="text-align: left;">3 (17.65%)</td>
</tr>
</tbody>
</table>


</div>
</div>
</section>
<section id="figure-1-averaged-vaccination-rates" class="level2">
<h2 class="anchored" data-anchor-id="figure-1-averaged-vaccination-rates">Figure 1: Averaged vaccination rates</h2>
<p>We showed the averaged vaccination rates reported by states. (States in red had reported vaccination rates, with darker shades representing higher vaccination rates. States in gray were missing vaccination rates.)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="do">#### Calulate averaged vaccination rate by state based on public spending per student (in $1,000 USD)</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>avg_overall_dat <span class="ot">&lt;-</span> <span class="fu">full_join</span>(</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  vaccine_overall <span class="sc">%&gt;%</span> </span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(state) <span class="sc">%&gt;%</span> </span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">avg_overall =</span> <span class="fu">mean</span>(overall)),</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>vaccine_overall <span class="sc">%&gt;%</span> </span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(state,spend_person,statespending2016) <span class="sc">%&gt;%</span> <span class="fu">unique</span>(),</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="at">by=</span> <span class="fu">c</span>(<span class="st">"state"</span>)</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a><span class="co"># avg_overall_dat %&gt;% datatable()</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>avg_mmr_dat <span class="ot">&lt;-</span> <span class="fu">full_join</span>(</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>  vaccine_mmr <span class="sc">%&gt;%</span> </span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(state) <span class="sc">%&gt;%</span> </span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">avg_mmr =</span> <span class="fu">mean</span>(mmr)),</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>vaccine_mmr <span class="sc">%&gt;%</span> </span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(state,spend_person,statespending2016) <span class="sc">%&gt;%</span> <span class="fu">unique</span>(),</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a><span class="at">by=</span> <span class="fu">c</span>(<span class="st">"state"</span>)</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a><span class="co"># avg_mmr_dat %&gt;% datatable()</span></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>avg_overall_dat<span class="sc">$</span>type <span class="ot">=</span> <span class="st">"Overall"</span></span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(avg_overall_dat) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"state"</span>, <span class="st">"avg_vaccine"</span>, <span class="st">"spend_person"</span>, <span class="st">"statespending2016"</span>, <span class="st">"type"</span></span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>avg_mmr_dat<span class="sc">$</span>type <span class="ot">=</span><span class="st">"MMR"</span></span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(avg_mmr_dat) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"state"</span>, <span class="st">"avg_vaccine"</span>, <span class="st">"spend_person"</span>, <span class="st">"statespending2016"</span>, <span class="st">"type"</span></span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a>avg_vaccine_dat <span class="ot">&lt;-</span> <span class="fu">rbind</span>(avg_overall_dat,avg_mmr_dat)</span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a>avg_vaccine_dat<span class="sc">$</span>type <span class="ot">&lt;-</span> <span class="fu">factor</span>(avg_vaccine_dat<span class="sc">$</span>type,</span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a>                               <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Overall"</span>,<span class="st">"MMR"</span>),</span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a>                               <span class="at">labels =</span><span class="fu">c</span>(<span class="st">"Overall"</span>,<span class="st">"MMR"</span>) )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="do">#### Figure 1A: Averaged Overall Vaccination Rate by State</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Load US states map data</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co"># us_states &lt;- st_as_sf(states())</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="co"># saveRDS(here("data","us_states.rds"))</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>us_states <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="fu">here</span>(<span class="st">"data"</span>,<span class="st">"us_states.rds"</span>))</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>overall_map <span class="ot">&lt;-</span> avg_overall_dat <span class="sc">%&gt;%</span> </span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">state =</span> <span class="fu">tolower</span>(state))</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>us_states <span class="ot">&lt;-</span> us_states <span class="sc">%&gt;%</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">NAME =</span> <span class="fu">tolower</span>(NAME))</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>geo_dat <span class="ot">&lt;-</span> <span class="fu">left_join</span>(us_states, overall_map, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"NAME"</span> <span class="ot">=</span> <span class="st">"state"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unique</span>()</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>geo_dat <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(geo_dat)</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a map with text labels for each state</span></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>overall_map_plt <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> geo_dat) <span class="sc">+</span></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> avg_vaccine)) <span class="sc">+</span>  <span class="co"># Color the states by spending</span></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># scale_fill_viridis_c() +  # Use the 'viridis' color scale</span></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>   <span class="fu">scale_fill_gradientn</span>(<span class="at">colors =</span> <span class="fu">c</span>(<span class="st">"#f4e1d2"</span>,<span class="st">"#f18973"</span>, <span class="st">"#bc5a45"</span>, <span class="st">"#9e3d2e"</span>),</span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>                        <span class="at">na.value =</span> <span class="st">"#D3D3D3"</span>  ) <span class="sc">+</span> </span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span>  <span class="co"># Use a minimal theme</span></span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>   <span class="co"># title = "Public Education Spending in Each State",</span></span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">""</span></span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>()</span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(</span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">125</span>, <span class="sc">-</span><span class="dv">66</span>),  <span class="co"># Longitude limits (approximate for the U.S.)</span></span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">24</span>, <span class="dv">50</span>)      <span class="co"># Latitude limits (approximate for the U.S.)</span></span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb10-39"><a href="#cb10-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">""</span>)<span class="sc">+</span></span>
<span id="cb10-40"><a href="#cb10-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">""</span>)<span class="sc">+</span></span>
<span id="cb10-41"><a href="#cb10-41" aria-hidden="true" tabindex="-1"></a> <span class="co"># geom_sf_text(aes(label = NAME), size = 1.5, color = "black")+</span></span>
<span id="cb10-42"><a href="#cb10-42" aria-hidden="true" tabindex="-1"></a> <span class="fu">theme</span>(</span>
<span id="cb10-43"><a href="#cb10-43" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb10-44"><a href="#cb10-44" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.text =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb10-45"><a href="#cb10-45" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb10-46"><a href="#cb10-46" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid =</span> <span class="fu">element_blank</span>()</span>
<span id="cb10-47"><a href="#cb10-47" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="do">#### Figure 1B: Averaged MMR Vaccination Rate by State</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>mmr_map <span class="ot">&lt;-</span> avg_mmr_dat <span class="sc">%&gt;%</span>  <span class="fu">mutate</span>(<span class="at">state =</span> <span class="fu">tolower</span>(state))</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>us_states <span class="ot">&lt;-</span> us_states <span class="sc">%&gt;%</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">NAME =</span> <span class="fu">tolower</span>(NAME))</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>geo_dat <span class="ot">&lt;-</span> <span class="fu">left_join</span>(us_states, mmr_map, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"NAME"</span> <span class="ot">=</span> <span class="st">"state"</span>))</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>geo_dat <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(geo_dat)</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a map with text labels for each state</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>mmr_map_plt <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> geo_dat) <span class="sc">+</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> avg_vaccine)) <span class="sc">+</span>  <span class="co"># Color the states by spending</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># scale_fill_viridis_c() +  # Use the 'viridis' color scale</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>   <span class="co"># scale_fill_gradient(low = "#feb236", high = "#ff7b25")+</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a> <span class="fu">scale_fill_gradientn</span>(<span class="at">colors =</span> <span class="fu">c</span>(<span class="st">"#f4e1d2"</span>,<span class="st">"#f18973"</span>, <span class="st">"#bc5a45"</span>, <span class="st">"#9e3d2e"</span>),</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>                        <span class="at">na.value =</span> <span class="st">"#D3D3D3"</span>  ) <span class="sc">+</span>  </span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span>  <span class="co"># Use a minimal theme</span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>   <span class="co"># title = "Public Education Spending in Each State",</span></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">""</span></span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>()</span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(</span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">125</span>, <span class="sc">-</span><span class="dv">66</span>),  <span class="co"># Longitude limits (approximate for the U.S.)</span></span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">24</span>, <span class="dv">50</span>)      <span class="co"># Latitude limits (approximate for the U.S.)</span></span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">""</span>)<span class="sc">+</span></span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">""</span>)<span class="sc">+</span></span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a> <span class="co"># geom_sf_text(aes(label = NAME), size = 1.5, color = "black")+</span></span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a> <span class="fu">theme</span>(</span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.text =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a>  <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a>  <span class="at">panel.grid =</span> <span class="fu">element_blank</span>()</span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a>  <span class="co"># STUSPS</span></span>
<span id="cb11-40"><a href="#cb11-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-41"><a href="#cb11-41" aria-hidden="true" tabindex="-1"></a><span class="co"># map_plts &lt;- ggarrange(overall_map_plt,mmr_map_plt)</span></span>
<span id="cb11-42"><a href="#cb11-42" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb11-43"><a href="#cb11-43" aria-hidden="true" tabindex="-1"></a><span class="co"># ggsave(map_plts,file=here("figures","map_plts.png"),dpi=300)</span></span>
<span id="cb11-44"><a href="#cb11-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-45"><a href="#cb11-45" aria-hidden="true" tabindex="-1"></a><span class="co"># ggsave(overall_map_plt,file=here("figures","overall_map_plt.png"),dpi=300)</span></span>
<span id="cb11-46"><a href="#cb11-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-47"><a href="#cb11-47" aria-hidden="true" tabindex="-1"></a><span class="co"># ggsave(mmr_map_plt,file=here("figures","mmr_map_plt.png"),dpi=300)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div>

</div>
<div class="cell quarto-layout-panel" data-layout-ncol="2">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="code_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption>(a) Averaged Overall Vaccination Rate by State</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="code_files/figure-html/unnamed-chunk-8-2.png" class="img-fluid figure-img" width="672"></p>
<figcaption>(b) Averaged MMR Vaccination Rate by State</figcaption>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<p>Figure 1. Averaged vaccination rates reported by states</p>
</div>
</div>
</div>
</section>
<section id="figure-2-averaged-vaccination-rates-contd" class="level2">
<h2 class="anchored" data-anchor-id="figure-2-averaged-vaccination-rates-contd">Figure 2: Averaged vaccination rates (cont’d)</h2>
<p>Scatterplots display the averaged vaccination rates for counties and states, based on public spending per student (in $1,000 USD). Each dot represents a different county.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="do">## prepare data</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>scatter_plot_overall <span class="ot">&lt;-</span> avg_vaccine_dat <span class="sc">%&gt;%</span> <span class="fu">filter</span>(type<span class="sc">==</span><span class="st">"Overall"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> spend_person, <span class="at">y =</span> avg_vaccine)) <span class="sc">+</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>,<span class="at">color=</span><span class="st">"gray"</span>,<span class="at">linetype=</span><span class="st">"dashed"</span>,<span class="at">size=</span><span class="dv">2</span>) <span class="sc">+</span>  <span class="co"># One overall trend line</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size=</span><span class="dv">5</span>,<span class="at">shape=</span><span class="dv">1</span>) <span class="sc">+</span>  </span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="sc">~</span>type)<span class="sc">+</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Public Spending per Studnet per School Year(in US Dollars)"</span>)<span class="sc">+</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Averaged Vaccination Rate in Each State"</span>)<span class="sc">+</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>),          <span class="co"># Overall text size</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">18</span>),     <span class="co"># Axis tick labels</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">22</span>, <span class="at">face =</span> <span class="st">"bold"</span>), <span class="co"># Axis titles</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">18</span>),   <span class="co"># Legend text size</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>, <span class="at">face =</span> <span class="st">"bold"</span>), <span class="co"># Legend title</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>, <span class="at">face =</span> <span class="st">"bold"</span>)  <span class="co"># Facet labels</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>scatter_plot_mmr <span class="ot">&lt;-</span> avg_vaccine_dat <span class="sc">%&gt;%</span> <span class="fu">filter</span>(type<span class="sc">==</span><span class="st">"MMR"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> spend_person, <span class="at">y =</span> avg_vaccine)) <span class="sc">+</span></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>,<span class="at">color=</span><span class="st">"gray"</span>,<span class="at">linetype=</span><span class="st">"dashed"</span>,<span class="at">size=</span><span class="dv">2</span>) <span class="sc">+</span>  <span class="co"># One overall trend line</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size=</span><span class="dv">5</span>,<span class="at">shape=</span><span class="dv">1</span>) <span class="sc">+</span>  </span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="sc">~</span>type)<span class="sc">+</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Public Spending per Student per School Year(in US Dollars)"</span>)<span class="sc">+</span></span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Averaged Vaccination Rate in Each State"</span>)<span class="sc">+</span></span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>),          <span class="co"># Overall text size</span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">18</span>),     <span class="co"># Axis tick labels</span></span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">22</span>, <span class="at">face =</span> <span class="st">"bold"</span>), <span class="co"># Axis titles</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">18</span>),   <span class="co"># Legend text size</span></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>, <span class="at">face =</span> <span class="st">"bold"</span>), <span class="co"># Legend title</span></span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>, <span class="at">face =</span> <span class="st">"bold"</span>)  <span class="co"># Facet labels</span></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Calulate average vaccination rates by county based on public spending per student (in $1,000 USD)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="do">#### Calulate averaged vaccination rate by county based on public spending per student (in $1,000 USD)</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>avg_overall_dat_county <span class="ot">&lt;-</span> <span class="fu">full_join</span>(</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  vaccine_overall <span class="sc">%&gt;%</span> </span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(state,county) <span class="sc">%&gt;%</span> </span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">avg_overall =</span> <span class="fu">mean</span>(overall)),</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>vaccine_overall <span class="sc">%&gt;%</span> </span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(state,county,spend_person,statespending2016) <span class="sc">%&gt;%</span> <span class="fu">unique</span>(),</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a><span class="at">by=</span> <span class="fu">c</span>(<span class="st">"state"</span>,<span class="st">"county"</span>)</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="co"># avg_overall_dat_county %&gt;% datatable()</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>avg_mmr_dat_county <span class="ot">&lt;-</span> <span class="fu">full_join</span>(</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>  vaccine_mmr <span class="sc">%&gt;%</span> </span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(state,county) <span class="sc">%&gt;%</span> </span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">avg_mmr =</span> <span class="fu">mean</span>(mmr)),</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>vaccine_mmr <span class="sc">%&gt;%</span> </span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(state,county,spend_person,statespending2016) <span class="sc">%&gt;%</span> <span class="fu">unique</span>(),</span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a><span class="at">by=</span> <span class="fu">c</span>(<span class="st">"state"</span>,<span class="st">"county"</span>)</span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a><span class="co"># avg_mmr_dat_county %&gt;% datatable()</span></span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>avg_overall_dat_county<span class="sc">$</span>type <span class="ot">=</span> <span class="st">"Overall"</span></span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(avg_overall_dat_county) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"state"</span>, <span class="st">"county"</span>,<span class="st">"avg_vaccine"</span>, <span class="st">"spend_person"</span>, <span class="st">"statespending2016"</span>, <span class="st">"type"</span></span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a>avg_mmr_dat_county<span class="sc">$</span>type <span class="ot">=</span><span class="st">"MMR"</span></span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(avg_mmr_dat_county) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"state"</span>,<span class="st">"county"</span>, <span class="st">"avg_vaccine"</span>, <span class="st">"spend_person"</span>, <span class="st">"statespending2016"</span>, <span class="st">"type"</span></span>
<span id="cb13-34"><a href="#cb13-34" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb13-35"><a href="#cb13-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-36"><a href="#cb13-36" aria-hidden="true" tabindex="-1"></a>avg_vaccine_dat_county <span class="ot">&lt;-</span> <span class="fu">rbind</span>(avg_overall_dat_county,avg_mmr_dat_county)</span>
<span id="cb13-37"><a href="#cb13-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-38"><a href="#cb13-38" aria-hidden="true" tabindex="-1"></a>avg_vaccine_dat_county<span class="sc">$</span>type <span class="ot">&lt;-</span> <span class="fu">factor</span>(avg_vaccine_dat_county<span class="sc">$</span>type,</span>
<span id="cb13-39"><a href="#cb13-39" aria-hidden="true" tabindex="-1"></a>                               <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Overall"</span>,<span class="st">"MMR"</span>),</span>
<span id="cb13-40"><a href="#cb13-40" aria-hidden="true" tabindex="-1"></a>                               <span class="at">labels =</span><span class="fu">c</span>(<span class="st">"Overall"</span>,<span class="st">"MMR"</span>) )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Plot averaged vaccination rate by county based on public spending per student (in $1,000 USD)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>scatter_res <span class="ot">&lt;-</span> avg_vaccine_dat_county <span class="sc">%&gt;%</span> </span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> spend_person, <span class="at">y =</span> avg_vaccine)) <span class="sc">+</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">"gray"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span>  <span class="co"># Overall trend line</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> state), <span class="at">size =</span> <span class="dv">5</span>) <span class="sc">+</span>  <span class="co"># Points from avg_overall_dat_county</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> avg_vaccine_dat, <span class="fu">aes</span>(<span class="at">x =</span> spend_person, <span class="at">y =</span> avg_vaccine), <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">5</span>, <span class="at">shape =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a> <span class="fu">facet_wrap</span>(<span class="sc">~</span>type) <span class="sc">+</span> </span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>   <span class="co">#geom_line(data = avg_overall_dat, aes(x = spend_person, y = avg_vaccine), color = "black", size = 0.5, shape = 1)</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Public Spending per Student per School Year (in US Dollars)"</span>) <span class="sc">+</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"Averaged Vaccination Rate in Each County"</span>) <span class="sc">+</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">18</span>),</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">16</span>),</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>,<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">16</span>,<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">18</span>, <span class="at">face =</span> <span class="st">"bold"</span>)</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>scatter_res</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="code_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="1536"></p>
<figcaption>Figure 2. Averaged Vaccination Rate by County</figcaption>
</figure>
</div>
</div>
</div>
<p>Plot averaged vaccination rate by state based on public spending per student (in $1,000 USD)</p>
<div>

</div>
<div class="cell quarto-layout-panel" data-layout-ncol="2">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="code_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="1536"></p>
<figcaption>(a) Averaged Overall Vaccination Rate by State</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="code_files/figure-html/unnamed-chunk-12-2.png" class="img-fluid figure-img" width="1536"></p>
<figcaption>(b) Averaged MMR Vaccination Rate by state</figcaption>
</figure>
</div>
</div>
</div>
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<p>Averaged Vaccination Rate by State</p>
</div>
</div>
</div>
</section>
</section>
<section id="part-2-model-and-diagnostics" class="level1">
<h1>PART 2: Model and Diagnostics</h1>
<p>In this part, we show how we built our model, and how the diagnostics were done. Specifically, <code>PART 2.1</code> is for overall vaccination rate outcome, and <code>PART 2.2</code> is for MMR vaccination rate outcome</p>
<section id="part-2.1-overall-vaccination-rate" class="level2">
<h2 class="anchored" data-anchor-id="part-2.1-overall-vaccination-rate">PART 2.1 : overall vaccination rate</h2>
<section id="model-1-multi-level-linear-mixed-effects-model" class="level3">
<h3 class="anchored" data-anchor-id="model-1-multi-level-linear-mixed-effects-model">Model 1: Multi-level Linear Mixed Effects model</h3>
<p>We first fit a linear mixed effects model with random intercept for county and state (three-level model) <span class="math display">\[
E(Y_{ijk}|b^{(3)}_{k},b^{(2)}_{jk}) = \beta_{1} + \beta_{2}\text{State spending}_k + \beta_{3}\text{School year}_i + \beta_{4}\text{State  electoral college}_k + {b}^{(3)}_k\ + {b}^{(2)}_{jk}\
\]</span></p>
<p>where Y is vaccination rate (Overall and MMR) for <em>i</em>th school in <em>j</em>th county and <em>k</em>th state (continuous), State spending is in US dollars per student of the <em>k</em>th state (continuous), School year of the <em>i</em>th school (categorical, with 2017-18 as reference category), State electoral college is the political party that the <em>k</em>th state predominantly voted for in 2017-2018 (categorical, with Swing State (vote fluctuates between parties) as the reference category), <span class="math inline">\({b}_k\)</span> is the random effect of the <em>k</em>th state (level 3), <span class="math inline">\({b}_jk\)</span> is the random effect for the <em>j</em>th county in the <em>k</em>th (level 2).</p>
</section>
<section id="table-3-three-level-fixed-effects-model-output" class="level3">
<h3 class="anchored" data-anchor-id="table-3-three-level-fixed-effects-model-output">Table 3: three-level fixed effects model output</h3>
<p>Fixed effects estimates from linear mixed effects models for school-level overall vaccination rates.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Fit 3-level LMM model </span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>lmm3 <span class="ot">&lt;-</span> <span class="fu">lmer</span>(overall_recode <span class="sc">~</span> spend_person <span class="sc">+</span> year_recode <span class="sc">+</span> state_political_vote <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> state) <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> county),</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">data =</span> vaccine_overall)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lmm3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear mixed model fit by REML ['lmerMod']
Formula: overall_recode ~ spend_person + year_recode + state_political_vote +  
    (1 | state) + (1 | county)
   Data: vaccine_overall

REML criterion at convergence: 176054.2

Scaled residuals: 
    Min      1Q  Median      3Q     Max 
-9.7300 -0.1194  0.2080  0.4303  2.9821 

Random effects:
 Groups   Name        Variance Std.Dev.
 county   (Intercept)  9.789   3.129   
 state    (Intercept) 27.887   5.281   
 Residual             92.955   9.641   
Number of obs: 23781, groups:  county, 781; state, 15

Fixed effects:
                                     Estimate Std. Error t value
(Intercept)                           84.7246     6.7144  12.618
spend_person                           0.5016     0.5446   0.921
year_recode2018-19                     2.5442     3.3447   0.761
state_political_voteDemocratic Party  -1.4772     4.8640  -0.304
state_political_voteRepublican Party  -0.2495     4.3635  -0.057

Correlation of Fixed Effects:
            (Intr) spnd_p y_2018 st__DP
spend_persn -0.665                     
yr_r2018-19 -0.426 -0.101              
stt_pltc_DP -0.317 -0.388  0.331       
stt_pltc_RP -0.559  0.026  0.124  0.688</code></pre>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="do">## obtain confidence intervals</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>(lmm3, <span class="at">oldNames =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                          2.5 %    97.5 %
sd_(Intercept)|county                 2.8542424  3.422292
sd_(Intercept)|state                  3.0935835  6.483911
sigma                                 9.5541119  9.729954
(Intercept)                          73.2585450 96.193929
spend_person                         -0.4292088  1.431540
year_recode2018-19                   -3.1648134  8.258885
state_political_voteDemocratic Party -9.7778284  6.830231
state_political_voteRepublican Party -7.6966319  7.201457</code></pre>
</div>
</div>
<p>We then tried some simpler models (Model 2 and Model 3) for comparison.</p>
</section>
<section id="model-2-linear-regression-model" class="level3">
<h3 class="anchored" data-anchor-id="model-2-linear-regression-model">Model 2: Linear regression model</h3>
<p><span class="math display">\[
E(Y_{ijk}) = \beta_{1} + \beta_{2}\text{State spending}_k + \beta_{3}\text{School year}_i + \beta_{4}\text{State political vote}_k
\]</span> We fit a linear regression model without random effects (base model)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>lr <span class="ot">&lt;-</span> <span class="fu">lm</span>(overall_recode <span class="sc">~</span> spend_person <span class="sc">+</span> year_recode <span class="sc">+</span> state_political_vote, <span class="at">data =</span> vaccine_overall)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">scipen=</span><span class="dv">999</span>)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = overall_recode ~ spend_person + year_recode + state_political_vote, 
    data = vaccine_overall)

Residuals:
    Min      1Q  Median      3Q     Max 
-92.366  -1.366   2.634   5.412  13.017 

Coefficients:
                                     Estimate Std. Error t value
(Intercept)                          85.49281    0.37258 229.461
spend_person                          0.35871    0.03159  11.355
year_recode2018-19                    3.65166    0.17320  21.084
state_political_voteDemocratic Party  0.47621    0.19566   2.434
state_political_voteRepublican Party -1.06002    0.19147  -5.536
                                                 Pr(&gt;|t|)    
(Intercept)                          &lt; 0.0000000000000002 ***
spend_person                         &lt; 0.0000000000000002 ***
year_recode2018-19                   &lt; 0.0000000000000002 ***
state_political_voteDemocratic Party               0.0149 *  
state_political_voteRepublican Party         0.0000000312 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 10.46 on 26229 degrees of freedom
Multiple R-squared:  0.0224,    Adjusted R-squared:  0.02225 
F-statistic: 150.3 on 4 and 26229 DF,  p-value: &lt; 0.00000000000000022</code></pre>
</div>
</div>
</section>
<section id="model-3-two-level-linear-mixed-effect-model" class="level3">
<h3 class="anchored" data-anchor-id="model-3-two-level-linear-mixed-effect-model">Model 3: Two-level linear mixed effect model</h3>
<p>We also fit linear mixed effects model with random intercept for state (two-level model)</p>
<p><span class="math display">\[
E(Y_{ijk}|b_{k}) = \beta_{1} + \beta_{2}\text{State spending}_k + \beta_{3}\text{School year}_i + \beta_{4}\text{State political party}_k + {b}_k\
\]</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Fit 2-level LMM model</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>lmm2 <span class="ot">&lt;-</span> <span class="fu">lmer</span>(overall_recode <span class="sc">~</span> spend_person <span class="sc">+</span> year_recode <span class="sc">+</span> state_political_vote <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> state), <span class="at">data =</span> vaccine_overall)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lmm2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear mixed model fit by REML ['lmerMod']
Formula: overall_recode ~ spend_person + year_recode + state_political_vote +  
    (1 | state)
   Data: vaccine_overall

REML criterion at convergence: 194774.1

Scaled residuals: 
    Min      1Q  Median      3Q     Max 
-9.4309 -0.1205  0.2305  0.4695  1.7673 

Random effects:
 Groups   Name        Variance Std.Dev.
 state    (Intercept) 21.21    4.605   
 Residual             97.88    9.893   
Number of obs: 26234, groups:  state, 17

Fixed effects:
                                     Estimate Std. Error t value
(Intercept)                           85.6839     5.1958  16.491
spend_person                           0.4276     0.4586   0.932
year_recode2018-19                     2.3752     2.8417   0.836
state_political_voteDemocratic Party  -0.8796     3.8217  -0.230
state_political_voteRepublican Party  -0.6198     3.2960  -0.188

Correlation of Fixed Effects:
            (Intr) spnd_p y_2018 st__DP
spend_persn -0.668                     
yr_r2018-19 -0.428 -0.158              
stt_pltc_DP -0.169 -0.506  0.353       
stt_pltc_RP -0.479 -0.018  0.143  0.611</code></pre>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="do">## obtain confidence intervals</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>(lmm2, <span class="at">oldNames =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                          2.5 %    97.5 %
sd_(Intercept)|state                  2.8476842  5.654050
sigma                                 9.8094148  9.978787
(Intercept)                          76.6204388 94.747538
spend_person                         -0.3725367  1.227605
year_recode2018-19                   -2.5806686  7.332485
state_political_voteDemocratic Party -7.5441694  5.786339
state_political_voteRepublican Party -6.3677634  5.128978</code></pre>
</div>
</div>
</section>
<section id="compare-model-1-model-2-model-3" class="level3">
<h3 class="anchored" data-anchor-id="compare-model-1-model-2-model-3">Compare Model 1, Model 2, Model 3</h3>
<p>We used AIC and BIC for model selection</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># extract AIC and BIC from base model</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>info_crit_base <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>            <span class="st">"AIC"</span> <span class="ot">=</span> <span class="fu">AIC</span>(lr),</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>            <span class="st">"BIC"</span> <span class="ot">=</span> <span class="fu">BIC</span>(lr)) <span class="sc">%&gt;%</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Model =</span> <span class="st">"Base model"</span>,</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">Outcome =</span> <span class="st">"Overall vaccination rate"</span>) </span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a><span class="co"># extract AIC and BIC from two-level model</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>info_crit2 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>            <span class="st">"AIC"</span> <span class="ot">=</span> <span class="fu">AIC</span>(lmm2),</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>            <span class="st">"BIC"</span> <span class="ot">=</span> <span class="fu">BIC</span>(lmm2)) <span class="sc">%&gt;%</span></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Model =</span> <span class="st">"Two-level"</span>,</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">Outcome =</span> <span class="st">"Overall vaccination rate"</span>)</span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a><span class="co"># extract AIC and BIC from three-level model</span></span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>info_crit_table <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>  <span class="st">"AIC"</span> <span class="ot">=</span> <span class="fu">AIC</span>(lmm3),</span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a>  <span class="st">"BIC"</span> <span class="ot">=</span> <span class="fu">BIC</span>(lmm3)) <span class="sc">%&gt;%</span></span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Model =</span> <span class="st">"Three-level"</span>,</span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>         <span class="at">Outcome =</span> <span class="st">"Overall vaccination rate"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># add values from two-level model and base model</span></span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rbind</span>(info_crit2, info_crit_base)</span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a>info_crit_table</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       AIC      BIC       Model                  Outcome
1 176070.2 176134.8 Three-level Overall vaccination rate
2 194788.1 194845.3   Two-level Overall vaccination rate
3 197626.5 197675.6  Base model Overall vaccination rate</code></pre>
</div>
</div>
<p>Since Model 1 had the lowest AIC and BIC values, we used it as our final model.</p>
</section>
<section id="check-model-diagnostics-of-model-1" class="level3">
<h3 class="anchored" data-anchor-id="check-model-diagnostics-of-model-1">Check model diagnostics of Model 1</h3>
<section id="diagnostics-for-stage-one-residuals" class="level4">
<h4 class="anchored" data-anchor-id="diagnostics-for-stage-one-residuals">Diagnostics for stage-one residuals</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="do">## obtain standardized stage-one residuals (school-level) manually</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="do">## this step takes a long time to run so this code chunk was excluded from the html output</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>condmean <span class="ot">&lt;-</span> <span class="fu">predict</span>(lmm3,<span class="at">allow.new.levels =</span> <span class="cn">TRUE</span>) <span class="co"># obtain conditional means</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> vaccine_overall<span class="sc">$</span>overall_recode</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>stg1r <span class="ot">&lt;-</span> y <span class="sc">-</span> condmean</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>estsigma2 <span class="ot">&lt;-</span> <span class="fu">sigma</span>(lmm3)<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>estsigmamat <span class="ot">&lt;-</span> estsigma2 <span class="sc">*</span> <span class="fu">diag</span>(<span class="fu">dim</span>(vaccine_overall)[<span class="dv">1</span>])</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Cholesky decomposition - this step takes a long tim</span></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>tictoc<span class="sc">::</span><span class="fu">tic</span>()</span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>L <span class="ot">&lt;-</span> <span class="fu">chol</span>(estsigmamat) </span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>tictoc<span class="sc">::</span><span class="fu">toc</span>()</span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(L,<span class="at">file=</span><span class="fu">here</span>(<span class="st">"data"</span>,<span class="st">"L.rds"</span>))</span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a>L <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="fu">here</span>(<span class="st">"data"</span>,<span class="st">"L.rds"</span>))</span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a>tictoc<span class="sc">::</span><span class="fu">tic</span>()</span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a>stg1rstar <span class="ot">&lt;-</span> <span class="fu">solve</span>(L) <span class="sc">%*%</span> stg1r</span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a>tictoc<span class="sc">::</span><span class="fu">toc</span>()</span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(stg1rstar,<span class="at">file=</span><span class="fu">here</span>(<span class="st">"data"</span>,<span class="st">"stg1rstar.rds"</span>))</span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(stg1rstar)</span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-24"><a href="#cb27-24" aria-hidden="true" tabindex="-1"></a><span class="do">## compare raw stage-one residuals and standardized residuals</span></span>
<span id="cb27-25"><a href="#cb27-25" aria-hidden="true" tabindex="-1"></a>rtype <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">"Raw"</span>, <span class="fu">length</span>(stg1r)), <span class="fu">rep</span>(<span class="st">"Standardized"</span>, <span class="fu">length</span>(stg1r)))</span>
<span id="cb27-26"><a href="#cb27-26" aria-hidden="true" tabindex="-1"></a>resid <span class="ot">&lt;-</span> <span class="fu">c</span>(stg1r, stg1rstar)</span>
<span id="cb27-27"><a href="#cb27-27" aria-hidden="true" tabindex="-1"></a>stg1resids <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">cbind</span>(rtype, <span class="fu">as.numeric</span>(resid)))</span>
<span id="cb27-28"><a href="#cb27-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-29"><a href="#cb27-29" aria-hidden="true" tabindex="-1"></a><span class="co"># create plot</span></span>
<span id="cb27-30"><a href="#cb27-30" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(stg1resids, <span class="fu">aes</span>(<span class="at">x =</span> resid, <span class="at">fill =</span> rtype)) <span class="sc">+</span></span>
<span id="cb27-31"><a href="#cb27-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">position =</span> <span class="st">"identity"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">bins =</span> <span class="dv">50</span>) <span class="sc">+</span></span>
<span id="cb27-32"><a href="#cb27-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Count"</span>, <span class="at">x =</span> <span class="st">"Residuals"</span>, <span class="at">fill =</span> <span class="st">"Type"</span>)</span>
<span id="cb27-33"><a href="#cb27-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-34"><a href="#cb27-34" aria-hidden="true" tabindex="-1"></a><span class="do">## Normal QQ Plot of standardized residuals</span></span>
<span id="cb27-35"><a href="#cb27-35" aria-hidden="true" tabindex="-1"></a><span class="fu">qqnorm</span>(stg1rstar, <span class="at">pch =</span> <span class="dv">1</span>)</span>
<span id="cb27-36"><a href="#cb27-36" aria-hidden="true" tabindex="-1"></a><span class="fu">qqline</span>(stg1rstar, <span class="at">col =</span> <span class="st">"steelblue"</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb27-37"><a href="#cb27-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-38"><a href="#cb27-38" aria-hidden="true" tabindex="-1"></a><span class="fu">qqnorm</span>(<span class="fu">residuals</span>(lmm3 , <span class="at">type =</span> <span class="st">"n"</span>)) <span class="co"># standardized residual</span></span>
<span id="cb27-39"><a href="#cb27-39" aria-hidden="true" tabindex="-1"></a><span class="fu">qqline</span>(<span class="fu">residuals</span>(lmm3 , <span class="at">type =</span> <span class="st">"n"</span>))</span>
<span id="cb27-40"><a href="#cb27-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-41"><a href="#cb27-41" aria-hidden="true" tabindex="-1"></a><span class="do">## Lagged residual plot</span></span>
<span id="cb27-42"><a href="#cb27-42" aria-hidden="true" tabindex="-1"></a>vaccine_overall <span class="sc">%&gt;%</span> </span>
<span id="cb27-43"><a href="#cb27-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rhat =</span> stg1rstar) <span class="sc">%&gt;%</span> </span>
<span id="cb27-44"><a href="#cb27-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(school_id) <span class="sc">%&gt;%</span> </span>
<span id="cb27-45"><a href="#cb27-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rhat1 =</span> <span class="fu">lag</span>(rhat)) <span class="sc">%&gt;%</span> </span>
<span id="cb27-46"><a href="#cb27-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> rhat, <span class="at">x=</span> rhat1))<span class="sc">+</span></span>
<span id="cb27-47"><a href="#cb27-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb27-48"><a href="#cb27-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Standardized Residual"</span>,<span class="at">x =</span> <span class="st">"Lagged Standardized Residual"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="standardized-residuals-against-predicted-mean" class="level4">
<h4 class="anchored" data-anchor-id="standardized-residuals-against-predicted-mean">standardized residuals against predicted mean</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>yhat <span class="ot">&lt;-</span> <span class="fu">predict</span>(lmm3)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">y =</span> stg1rstar, <span class="at">x =</span> yhat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="diagnostics-for-random-effects" class="level4">
<h4 class="anchored" data-anchor-id="diagnostics-for-random-effects">Diagnostics for random effects</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>bjkhat <span class="ot">&lt;-</span> <span class="fu">ranef</span>(lmm3, <span class="at">condVar =</span> <span class="cn">TRUE</span>)<span class="sc">$</span>county <span class="sc">%&gt;%</span> <span class="fu">pull</span>()</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="fu">qqnorm</span>(bjkhat, <span class="at">pch =</span> <span class="dv">1</span>)</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="fu">qqline</span>(bjkhat, <span class="at">col =</span> <span class="st">"steelblue"</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="code_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption>Normal qqplot of the county-level random effects</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>bkhat <span class="ot">&lt;-</span> <span class="fu">ranef</span>(lmm3, <span class="at">condVar =</span> <span class="cn">TRUE</span>)<span class="sc">$</span>state <span class="sc">%&gt;%</span> <span class="fu">pull</span>()</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="fu">qqnorm</span>(bkhat, <span class="at">pch =</span> <span class="dv">1</span>)</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="fu">qqline</span>(bkhat, <span class="at">col =</span> <span class="st">"steelblue"</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="code_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption>Normal qqplot of the state-level random effects</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ranef</span>(lmm3)<span class="sc">$</span>county <span class="sc">%&gt;%</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(<span class="st">"(Intercept)"</span>),</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">"ranefs"</span>,</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"estimates"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> estimates)) <span class="sc">+</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">position =</span> <span class="st">"identity"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">bins =</span> <span class="dv">50</span>, <span class="at">fill =</span> <span class="st">"orange"</span>) <span class="sc">+</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="sc">~</span> ranefs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="code_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption>Histogram of county random effects residuals</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ranef</span>(lmm3)<span class="sc">$</span>state <span class="sc">%&gt;%</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(<span class="st">"(Intercept)"</span>),</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">"ranefs"</span>,</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"estimates"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> estimates)) <span class="sc">+</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">position =</span> <span class="st">"identity"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">bins =</span> <span class="dv">50</span>, <span class="at">fill =</span> <span class="st">"orange"</span>) <span class="sc">+</span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="sc">~</span> ranefs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="code_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption>Histogram of state random effects residuals</figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="table-4-intra-class-clustering" class="level3">
<h3 class="anchored" data-anchor-id="table-4-intra-class-clustering">Table 4: Intra-class clustering</h3>
<p>Random effect variances and intra-class correlation coefficients from linear mixed effects models for school-level overall vaccination rate.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="do">## extract random effects variances</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>re_variance <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">VarCorr</span>(lmm3))</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="co"># create vector for county random effect variance</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>re_var_county <span class="ot">&lt;-</span> re_variance <span class="sc">%&gt;%</span> <span class="fu">filter</span>(grp<span class="sc">==</span><span class="st">"county"</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(vcov) <span class="sc">%&gt;%</span> <span class="fu">pull</span>()</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a><span class="co"># create vector for state random effect variance</span></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>re_var_state <span class="ot">&lt;-</span> re_variance <span class="sc">%&gt;%</span> <span class="fu">filter</span>(grp<span class="sc">==</span><span class="st">"state"</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(vcov) <span class="sc">%&gt;%</span> <span class="fu">pull</span>()</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a><span class="co"># create vector for error term variance</span></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>re_var_resid <span class="ot">&lt;-</span> re_variance <span class="sc">%&gt;%</span> <span class="fu">filter</span>(grp<span class="sc">==</span><span class="st">"Residual"</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(vcov) <span class="sc">%&gt;%</span> <span class="fu">pull</span>()</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a><span class="do">## correlation between two schools in the same county within the same state</span></span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>corr_county <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">as.numeric</span>(re_var_county <span class="sc">+</span> re_var_state) <span class="sc">/</span> (re_var_resid <span class="sc">+</span> re_var_state <span class="sc">+</span> re_var_county)) <span class="sc">%&gt;%</span></span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">Correlation_coefficient =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Type =</span> <span class="st">"Schools in same county"</span>)</span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a><span class="do">## correlation between two schools in different counties but within the same state</span></span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a>corr_state <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">as.numeric</span>(re_var_state <span class="sc">/</span> (re_var_resid <span class="sc">+</span> re_var_state <span class="sc">+</span> re_var_county))) <span class="sc">%&gt;%</span></span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">Correlation_coefficient =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Type =</span> <span class="st">"Schools in different counties within same state"</span>)</span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-23"><a href="#cb33-23" aria-hidden="true" tabindex="-1"></a><span class="do">## summarise results in table</span></span>
<span id="cb33-24"><a href="#cb33-24" aria-hidden="true" tabindex="-1"></a>corr_table <span class="ot">&lt;-</span> <span class="fu">rbind</span>(corr_county, corr_state) <span class="sc">%&gt;%</span></span>
<span id="cb33-25"><a href="#cb33-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Type, Correlation_coefficient)</span>
<span id="cb33-26"><a href="#cb33-26" aria-hidden="true" tabindex="-1"></a>corr_table</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                             Type Correlation_coefficient
1                          Schools in same county               0.2884146
2 Schools in different counties within same state               0.2134811</code></pre>
</div>
</div>
</section>
</section>
<section id="part-2.2-mmr-vaccination-rate" class="level2">
<h2 class="anchored" data-anchor-id="part-2.2-mmr-vaccination-rate">PART 2.2: MMR vaccination rate</h2>
<p>In the following part, we built a model for MMR vaccination rate.</p>
<section id="model-4-fit-linear-mixed-effects-model" class="level3">
<h3 class="anchored" data-anchor-id="model-4-fit-linear-mixed-effects-model">Model 4: Fit Linear Mixed Effects model</h3>
<p>Fit main model: linear mixed effects model with random intercept for county and state (three-level model)</p>
</section>
<section id="table-3-three-level-fixed-effects-model-output-1" class="level3">
<h3 class="anchored" data-anchor-id="table-3-three-level-fixed-effects-model-output-1">Table 3: three-level fixed effects model output</h3>
<p>Fixed effects estimate from linear mixed effects models for school-level Measles, Mumps, and Rubella (MMR) vaccination rates.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="do">## fit 3-level LMM model</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>lmm3mmr <span class="ot">&lt;-</span> <span class="fu">lmer</span>(mmr_recode <span class="sc">~</span> spend_person <span class="sc">+</span> year_recode <span class="sc">+</span> state_political_vote <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> state) <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> county),</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">data =</span> vaccine_mmr)</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lmm3mmr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear mixed model fit by REML ['lmerMod']
Formula: mmr_recode ~ spend_person + year_recode + state_political_vote +  
    (1 | state) + (1 | county)
   Data: vaccine_mmr

REML criterion at convergence: 184005.8

Scaled residuals: 
     Min       1Q   Median       3Q      Max 
-11.1649  -0.0694   0.1923   0.3739   3.9705 

Random effects:
 Groups   Name        Variance Std.Dev.
 county   (Intercept) 12.324   3.511   
 state    (Intercept)  4.155   2.038   
 Residual             73.006   8.544   
Number of obs: 25687, groups:  county, 700; state, 18

Fixed effects:
                                     Estimate Std. Error t value
(Intercept)                          90.82078    2.26813  40.042
spend_person                          0.05329    0.17650   0.302
year_recode2018-19                    0.68067    1.03437   0.658
state_political_voteDemocratic Party  1.93974    1.54752   1.253
state_political_voteRepublican Party  2.15312    1.56750   1.374

Correlation of Fixed Effects:
            (Intr) spnd_p y_2018 st__DP
spend_persn -0.779                     
yr_r2018-19 -0.356  0.088              
stt_pltc_DP -0.194 -0.349  0.023       
stt_pltc_RP -0.578  0.098  0.198  0.630</code></pre>
</div>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="do">## obtain confidence intervals</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>(lmm3mmr, <span class="at">oldNames =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                          2.5 %     97.5 %
sd_(Intercept)|county                 3.2248034  3.8162255
sd_(Intercept)|state                  1.2333469  2.5469026
sigma                                 8.4701153  8.6197131
(Intercept)                          86.7899486 94.8447800
spend_person                         -0.2597612  0.3664056
year_recode2018-19                   -1.1504397  2.5150425
state_political_voteDemocratic Party -0.8016424  4.6899224
state_political_voteRepublican Party -0.6287517  4.9349215</code></pre>
</div>
</div>
</section>
<section id="model-5-linear-regression-model-base-model" class="level3">
<h3 class="anchored" data-anchor-id="model-5-linear-regression-model-base-model">Model 5: linear regression model (base model)</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Fit linear regression model without random effects (base model)</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>lr_mmr <span class="ot">&lt;-</span> <span class="fu">lm</span>(mmr_recode <span class="sc">~</span> spend_person <span class="sc">+</span> year_recode <span class="sc">+</span> state_political_vote, <span class="at">data =</span> vaccine_mmr)</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lr_mmr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = mmr_recode ~ spend_person + year_recode + state_political_vote, 
    data = vaccine_mmr)

Residuals:
    Min      1Q  Median      3Q     Max 
-94.228  -0.228   2.772   3.825   9.919 

Coefficients:
                                     Estimate Std. Error t value
(Intercept)                           91.3520     0.2719 335.947
spend_person                           0.1951     0.0197   9.904
year_recode2018-19                     0.7236     0.1294   5.591
state_political_voteDemocratic Party   1.1158     0.1696   6.577
state_political_voteRepublican Party  -2.4205     0.1931 -12.534
                                                 Pr(&gt;|t|)    
(Intercept)                          &lt; 0.0000000000000002 ***
spend_person                         &lt; 0.0000000000000002 ***
year_recode2018-19                        0.0000000227948 ***
state_political_voteDemocratic Party      0.0000000000489 ***
state_political_voteRepublican Party &lt; 0.0000000000000002 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 9.154 on 28319 degrees of freedom
Multiple R-squared:  0.03348,   Adjusted R-squared:  0.03334 
F-statistic: 245.2 on 4 and 28319 DF,  p-value: &lt; 0.00000000000000022</code></pre>
</div>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(lr_mmr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Variance Table

Response: mmr_recode
                        Df  Sum Sq Mean Sq F value                Pr(&gt;F)    
spend_person             1   30578 30578.3  364.94 &lt; 0.00000000000000022 ***
year_recode              1    7880  7879.6   94.04 &lt; 0.00000000000000022 ***
state_political_vote     2   43730 21864.9  260.95 &lt; 0.00000000000000022 ***
Residuals            28319 2372865    83.8                                  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
</section>
<section id="model-6-two-level-linear-mixed-effect-model" class="level3">
<h3 class="anchored" data-anchor-id="model-6-two-level-linear-mixed-effect-model">Model 6: two-level linear mixed effect model</h3>
<p>We also fit linear mixed effects model with random intercept for state (two-level model)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Fit 2-level LMM model</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>lmm2mmr <span class="ot">&lt;-</span> <span class="fu">lmer</span>(mmr_recode <span class="sc">~</span> spend_person <span class="sc">+</span> year_recode <span class="sc">+</span> state_political_vote <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> state), <span class="at">data =</span> vaccine_mmr)</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lmm2mmr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear mixed model fit by REML ['lmerMod']
Formula: mmr_recode ~ spend_person + year_recode + state_political_vote +  
    (1 | state)
   Data: vaccine_mmr

REML criterion at convergence: 203680.6

Scaled residuals: 
     Min       1Q   Median       3Q      Max 
-10.7461  -0.0669   0.2565   0.3875   1.7555 

Random effects:
 Groups   Name        Variance Std.Dev.
 state    (Intercept) 13.58    3.686   
 Residual             77.48    8.802   
Number of obs: 28324, groups:  state, 21

Fixed effects:
                                     Estimate Std. Error t value
(Intercept)                           92.3622     3.8019  24.294
spend_person                           0.1380     0.2969   0.465
year_recode2018-19                    -1.4311     1.6366  -0.874
state_political_voteDemocratic Party   1.5251     2.3432   0.651
state_political_voteRepublican Party  -1.3643     2.3146  -0.589

Correlation of Fixed Effects:
            (Intr) spnd_p y_2018 st__DP
spend_persn -0.847                     
yr_r2018-19 -0.332  0.144              
stt_pltc_DP -0.109 -0.314 -0.084       
stt_pltc_RP -0.559  0.202  0.027  0.568</code></pre>
</div>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="do">## obtain confidence intervals</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>(lmm2mmr, <span class="at">oldNames =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                         2.5 %     97.5 %
sd_(Intercept)|state                  2.430311  4.5088983
sigma                                 8.730134  8.8751625
(Intercept)                          85.548979 99.1733636
spend_person                         -0.393943  0.6700675
year_recode2018-19                   -4.362439  1.5028530
state_political_voteDemocratic Party -2.673625  5.7233117
state_political_voteRepublican Party -5.511982  2.7832133</code></pre>
</div>
</div>
</section>
<section id="compare-model-4-model-5-and-model-6" class="level3">
<h3 class="anchored" data-anchor-id="compare-model-4-model-5-and-model-6">Compare Model 4, Model 5, and Model 6</h3>
<p>We also compared the model fit of Model 4, 5, and 6 using AIC and BIC</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="do">## extract AIC and BIC from base model</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>info_crit_mmr_base <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>            <span class="st">"AIC"</span> <span class="ot">=</span> <span class="fu">AIC</span>(lr_mmr),</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>            <span class="st">"BIC"</span> <span class="ot">=</span> <span class="fu">BIC</span>(lr_mmr)) <span class="sc">%&gt;%</span></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Model =</span> <span class="st">"Base model"</span>,</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">Outcome =</span> <span class="st">"MMR vaccination rate"</span>)</span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a><span class="do">## extract AIC and BIC from two-level model</span></span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>info_crit_mmr2 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a>            <span class="st">"AIC"</span> <span class="ot">=</span> <span class="fu">AIC</span>(lmm2mmr),</span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a>            <span class="st">"BIC"</span> <span class="ot">=</span> <span class="fu">BIC</span>(lmm2mmr)) <span class="sc">%&gt;%</span></span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Model =</span> <span class="st">"Two-level"</span>,</span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">Outcome =</span> <span class="st">"MMR vaccination rate"</span>)</span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a><span class="do">## extract AIC and BIC from three-level model</span></span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a>info_crit_table_mmr <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb47-17"><a href="#cb47-17" aria-hidden="true" tabindex="-1"></a>  <span class="st">"AIC"</span> <span class="ot">=</span> <span class="fu">AIC</span>(lmm3mmr),</span>
<span id="cb47-18"><a href="#cb47-18" aria-hidden="true" tabindex="-1"></a>  <span class="st">"BIC"</span> <span class="ot">=</span> <span class="fu">BIC</span>(lmm3mmr)) <span class="sc">%&gt;%</span></span>
<span id="cb47-19"><a href="#cb47-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Model =</span> <span class="st">"Three-level"</span>,</span>
<span id="cb47-20"><a href="#cb47-20" aria-hidden="true" tabindex="-1"></a>         <span class="at">Outcome =</span> <span class="st">"MMR vaccination rate"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb47-21"><a href="#cb47-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># add values from two-level model and base model</span></span>
<span id="cb47-22"><a href="#cb47-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rbind</span>(info_crit_mmr2, info_crit_mmr_base)</span>
<span id="cb47-23"><a href="#cb47-23" aria-hidden="true" tabindex="-1"></a>info_crit_table_mmr</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       AIC      BIC       Model              Outcome
1 184021.8 184087.0 Three-level MMR vaccination rate
2 203694.6 203752.4   Two-level MMR vaccination rate
3 205814.8 205864.3  Base model MMR vaccination rate</code></pre>
</div>
</div>
</section>
<section id="check-model-diagnostics-of-model-4" class="level3">
<h3 class="anchored" data-anchor-id="check-model-diagnostics-of-model-4">Check model diagnostics of Model 4</h3>
<section id="diagnostics-for-stage-one-residuals-1" class="level4">
<h4 class="anchored" data-anchor-id="diagnostics-for-stage-one-residuals-1">Diagnostics for stage-one residuals</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="do">## obtain standardized stage-one residuals (school-level) manually</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="do">## this step takes a long time to run so this code chunk was excluded from the html output</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>condmean <span class="ot">&lt;-</span> <span class="fu">predict</span>(lmm3mmr, <span class="at">newdata =</span> vaccine_mmr, <span class="at">allow.new.levels =</span> <span class="cn">TRUE</span>)</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> vaccine_mmr<span class="sc">$</span>mmr_recode</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>stg1r_mmr <span class="ot">&lt;-</span> y <span class="sc">-</span> condmean</span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>estsigma2 <span class="ot">&lt;-</span> <span class="fu">sigma</span>(lmm3mmr)<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>estsigmamat <span class="ot">&lt;-</span> estsigma2 <span class="sc">*</span> <span class="fu">diag</span>(<span class="fu">dim</span>(vaccine_mmr)[<span class="dv">1</span>])</span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Cholesky decomposition - this step takes a long time</span></span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a>tictoc<span class="sc">::</span><span class="fu">tic</span>()</span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a>Lmmr <span class="ot">&lt;-</span> <span class="fu">chol</span>(estsigmamat) </span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a>tictoc<span class="sc">::</span><span class="fu">toc</span>()</span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(Lmmr,<span class="at">file=</span><span class="fu">here</span>(<span class="st">"data"</span>,<span class="st">"Lmmr.rds"</span>))</span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(stg1r_mmr,<span class="at">file=</span><span class="fu">here</span>(<span class="st">"data"</span>,<span class="st">"stg1r_mmr.rds"</span>))</span>
<span id="cb49-16"><a href="#cb49-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-17"><a href="#cb49-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-18"><a href="#cb49-18" aria-hidden="true" tabindex="-1"></a>Lmmr <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="fu">here</span>(<span class="st">"data"</span>,<span class="st">"Lmmr.rds"</span>))</span>
<span id="cb49-19"><a href="#cb49-19" aria-hidden="true" tabindex="-1"></a>stg1r_mmr <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="fu">here</span>(<span class="st">"data"</span>,<span class="st">"stg1r_mmr.rds"</span>))</span>
<span id="cb49-20"><a href="#cb49-20" aria-hidden="true" tabindex="-1"></a>tictoc<span class="sc">::</span><span class="fu">tic</span>()</span>
<span id="cb49-21"><a href="#cb49-21" aria-hidden="true" tabindex="-1"></a>stg1rstar_mmr <span class="ot">&lt;-</span> <span class="fu">solve</span>(Lmmr) <span class="sc">%*%</span> stg1r_mmr</span>
<span id="cb49-22"><a href="#cb49-22" aria-hidden="true" tabindex="-1"></a>tictoc<span class="sc">::</span><span class="fu">toc</span>()</span>
<span id="cb49-23"><a href="#cb49-23" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(stg1rstar_mmr,<span class="at">file=</span><span class="fu">here</span>(<span class="st">"data"</span>,<span class="st">"stg1rstar_mmr.rds"</span>))</span>
<span id="cb49-24"><a href="#cb49-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-25"><a href="#cb49-25" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(stg1rstar_mmr)</span>
<span id="cb49-26"><a href="#cb49-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-27"><a href="#cb49-27" aria-hidden="true" tabindex="-1"></a><span class="do">## compare raw stage-one residuals and standardized residuals</span></span>
<span id="cb49-28"><a href="#cb49-28" aria-hidden="true" tabindex="-1"></a>rtype_mmr <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">"Raw"</span>, <span class="fu">length</span>(stg1r_mmr)), <span class="fu">rep</span>(<span class="st">"Standardized"</span>, <span class="fu">length</span>(stg1r_mmr)))</span>
<span id="cb49-29"><a href="#cb49-29" aria-hidden="true" tabindex="-1"></a>resid_mmr <span class="ot">&lt;-</span> <span class="fu">c</span>(stg1r_mmr, stg1rstar_mmr)</span>
<span id="cb49-30"><a href="#cb49-30" aria-hidden="true" tabindex="-1"></a>stg1resids_mmr <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">cbind</span>(rtype_mmr, <span class="fu">as.numeric</span>(resid_mmr)))</span>
<span id="cb49-31"><a href="#cb49-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-32"><a href="#cb49-32" aria-hidden="true" tabindex="-1"></a><span class="co"># create plot</span></span>
<span id="cb49-33"><a href="#cb49-33" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(stg1resids_mmr, <span class="fu">aes</span>(<span class="at">x =</span> resid_mmr, <span class="at">fill =</span> rtype_mmr)) <span class="sc">+</span></span>
<span id="cb49-34"><a href="#cb49-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">position =</span> <span class="st">"identity"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">bins =</span> <span class="dv">50</span>) <span class="sc">+</span></span>
<span id="cb49-35"><a href="#cb49-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Count"</span>, <span class="at">x =</span> <span class="st">"Residuals"</span>, <span class="at">fill =</span> <span class="st">"Type"</span>)</span>
<span id="cb49-36"><a href="#cb49-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-37"><a href="#cb49-37" aria-hidden="true" tabindex="-1"></a><span class="do">## Lagged residual plot</span></span>
<span id="cb49-38"><a href="#cb49-38" aria-hidden="true" tabindex="-1"></a>vaccine_mmr <span class="sc">%&gt;%</span> </span>
<span id="cb49-39"><a href="#cb49-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rhat =</span> stg1rstar_mmr) <span class="sc">%&gt;%</span> </span>
<span id="cb49-40"><a href="#cb49-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(school_id) <span class="sc">%&gt;%</span> </span>
<span id="cb49-41"><a href="#cb49-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rhat1 =</span> <span class="fu">lag</span>(rhat)) <span class="sc">%&gt;%</span> </span>
<span id="cb49-42"><a href="#cb49-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> rhat, <span class="at">x=</span> rhat1))<span class="sc">+</span></span>
<span id="cb49-43"><a href="#cb49-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb49-44"><a href="#cb49-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Standardized Residual"</span>,<span class="at">x =</span> <span class="st">"Lagged Standardized Residual"</span>)</span>
<span id="cb49-45"><a href="#cb49-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-46"><a href="#cb49-46" aria-hidden="true" tabindex="-1"></a><span class="do">## Normal QQ Plot of standardized residuals</span></span>
<span id="cb49-47"><a href="#cb49-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-48"><a href="#cb49-48" aria-hidden="true" tabindex="-1"></a><span class="fu">qqnorm</span>(stg1rstar_mmr, <span class="at">pch =</span> <span class="dv">1</span>)</span>
<span id="cb49-49"><a href="#cb49-49" aria-hidden="true" tabindex="-1"></a><span class="fu">qqline</span>(stg1rstar_mmr, <span class="at">col =</span> <span class="st">"steelblue"</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb49-50"><a href="#cb49-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-51"><a href="#cb49-51" aria-hidden="true" tabindex="-1"></a><span class="fu">qqnorm</span>(<span class="fu">residuals</span>(lmm3mmr , <span class="at">type =</span> <span class="st">"n"</span>)) <span class="co"># standardized residual</span></span>
<span id="cb49-52"><a href="#cb49-52" aria-hidden="true" tabindex="-1"></a><span class="fu">qqline</span>(<span class="fu">residuals</span>(lmm3mmr , <span class="at">type =</span> <span class="st">"n"</span>))</span>
<span id="cb49-53"><a href="#cb49-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-54"><a href="#cb49-54" aria-hidden="true" tabindex="-1"></a><span class="do">## Plot standardized residuals against predicted mean</span></span>
<span id="cb49-55"><a href="#cb49-55" aria-hidden="true" tabindex="-1"></a>yhat <span class="ot">&lt;-</span> <span class="fu">predict</span>(lmm3mmr)</span>
<span id="cb49-56"><a href="#cb49-56" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">y =</span> stg1rstar_mmr, <span class="at">x =</span> yhat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="diagnostics-of-random-effects" class="level4">
<h4 class="anchored" data-anchor-id="diagnostics-of-random-effects">Diagnostics of random effects</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Normal qqplot of the random effects: county-level random effects</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>bjkhat <span class="ot">&lt;-</span> <span class="fu">ranef</span>(lmm3mmr, <span class="at">condVar =</span> <span class="cn">TRUE</span>)<span class="sc">$</span>county <span class="sc">%&gt;%</span> <span class="fu">pull</span>()</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a><span class="fu">qqnorm</span>(bjkhat, <span class="at">pch =</span> <span class="dv">1</span>)</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a><span class="fu">qqline</span>(bjkhat, <span class="at">col =</span> <span class="st">"steelblue"</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="code_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption>Normal qqplot of the county-level random effects</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Normal qqplot of the random effects: state-level random effects</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>bkhat <span class="ot">&lt;-</span> <span class="fu">ranef</span>(lmm3mmr, <span class="at">condVar =</span> <span class="cn">TRUE</span>)<span class="sc">$</span>state <span class="sc">%&gt;%</span> <span class="fu">pull</span>()</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a><span class="fu">qqnorm</span>(bkhat, <span class="at">pch =</span> <span class="dv">1</span>)</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a><span class="fu">qqline</span>(bkhat, <span class="at">col =</span> <span class="st">"steelblue"</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="code_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption>Normal qqplot of the state-level random effects</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Histogram of county random effects residuals</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ranef</span>(lmm3mmr)<span class="sc">$</span>county <span class="sc">%&gt;%</span></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(<span class="st">"(Intercept)"</span>),</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">"ranefs"</span>,</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"estimates"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> estimates)) <span class="sc">+</span></span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">position =</span> <span class="st">"identity"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">bins =</span> <span class="dv">50</span>, <span class="at">fill =</span> <span class="st">"orange"</span>) <span class="sc">+</span></span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="sc">~</span> ranefs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="code_files/figure-html/unnamed-chunk-29-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption>Histogram of county random effects residuals</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Histogram of state random effects residuals</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ranef</span>(lmm3mmr)<span class="sc">$</span>state <span class="sc">%&gt;%</span></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(<span class="st">"(Intercept)"</span>),</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">"ranefs"</span>,</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">"estimates"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> estimates)) <span class="sc">+</span></span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">position =</span> <span class="st">"identity"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">bins =</span> <span class="dv">50</span>, <span class="at">fill =</span> <span class="st">"orange"</span>) <span class="sc">+</span></span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="sc">~</span> ranefs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="code_files/figure-html/unnamed-chunk-30-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption>Histogram of state random effects residuals</figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="table-4-intra-class-correlation" class="level3">
<h3 class="anchored" data-anchor-id="table-4-intra-class-correlation">Table 4: intra-class correlation</h3>
<p>Random effect variances and intra-class correlation coefficients from linear mixed effects models for Measles, Mumps, and Rubella (MMR) vaccination rates.</p>
<div class="cell" data-tbl_cap="Table 4. Random Effect Variance and Intra-class Correlation Coefficients">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="do">## extract random effects variances</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>re_variance_mmr <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">VarCorr</span>(lmm3mmr))</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a><span class="co"># create vector for county random effect variance</span></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>re_var_county_mmr <span class="ot">&lt;-</span> re_variance_mmr <span class="sc">%&gt;%</span> <span class="fu">filter</span>(grp<span class="sc">==</span><span class="st">"county"</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(vcov) <span class="sc">%&gt;%</span> <span class="fu">pull</span>()</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a><span class="co"># create vector for state random effect variance</span></span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>re_var_state_mmr <span class="ot">&lt;-</span> re_variance_mmr <span class="sc">%&gt;%</span> <span class="fu">filter</span>(grp<span class="sc">==</span><span class="st">"state"</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(vcov) <span class="sc">%&gt;%</span> <span class="fu">pull</span>()</span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a><span class="co"># create vector for error term variance</span></span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a>re_var_resid_mmr <span class="ot">&lt;-</span> re_variance_mmr <span class="sc">%&gt;%</span> <span class="fu">filter</span>(grp<span class="sc">==</span><span class="st">"Residual"</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(vcov) <span class="sc">%&gt;%</span> <span class="fu">pull</span>()</span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb54-13"><a href="#cb54-13" aria-hidden="true" tabindex="-1"></a><span class="do">## correlation between two schools in the same county within the same state</span></span>
<span id="cb54-14"><a href="#cb54-14" aria-hidden="true" tabindex="-1"></a>corr_county_mmr <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">as.numeric</span>(re_var_county_mmr <span class="sc">+</span> re_var_state_mmr) <span class="sc">/</span> (re_var_resid_mmr <span class="sc">+</span> re_var_state_mmr <span class="sc">+</span> re_var_county_mmr)) <span class="sc">%&gt;%</span></span>
<span id="cb54-15"><a href="#cb54-15" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">Correlation_coefficient =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb54-16"><a href="#cb54-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Type =</span> <span class="st">"Schools in same county"</span>)</span>
<span id="cb54-17"><a href="#cb54-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-18"><a href="#cb54-18" aria-hidden="true" tabindex="-1"></a><span class="do">## correlation between two schools in different counties but within the same state</span></span>
<span id="cb54-19"><a href="#cb54-19" aria-hidden="true" tabindex="-1"></a>corr_state_mmr <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">as.numeric</span>(re_var_state_mmr <span class="sc">/</span> (re_var_resid_mmr <span class="sc">+</span> re_var_state_mmr <span class="sc">+</span> re_var_county_mmr))) <span class="sc">%&gt;%</span></span>
<span id="cb54-20"><a href="#cb54-20" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">Correlation_coefficient =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb54-21"><a href="#cb54-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Type =</span> <span class="st">"Schools in different counties within same state"</span>)</span>
<span id="cb54-22"><a href="#cb54-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-23"><a href="#cb54-23" aria-hidden="true" tabindex="-1"></a>corr_table_mmr <span class="ot">&lt;-</span> <span class="fu">rbind</span>(corr_county_mmr, corr_state_mmr) <span class="sc">%&gt;%</span></span>
<span id="cb54-24"><a href="#cb54-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Type, Correlation_coefficient)</span>
<span id="cb54-25"><a href="#cb54-25" aria-hidden="true" tabindex="-1"></a>corr_table_mmr</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                             Type Correlation_coefficient
1                          Schools in same county              0.18415253
2 Schools in different counties within same state              0.04643449</code></pre>
</div>
</div>
</section>
</section>
</section>
<section id="part-3-supplementary-tables" class="level1">
<h1>PART 3: Supplementary Tables</h1>
<section id="supplementary-table-a1-more-detailed-summary-statistics-by-state" class="level3">
<h3 class="anchored" data-anchor-id="supplementary-table-a1-more-detailed-summary-statistics-by-state">Supplementary Table A1: More detailed summary statistics by state</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>generate_table <span class="ot">&lt;-</span> <span class="cf">function</span>(data, filter_conditions) {</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>  data <span class="sc">%&gt;%</span></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!!!</span>filter_conditions) <span class="sc">%&gt;%</span></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(state) <span class="sc">%&gt;%</span></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(</span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">county_number =</span> <span class="fu">n_distinct</span>(county, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">school_number =</span> <span class="fu">length</span>(name),</span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">spending =</span> <span class="fu">unique</span>(statespending2016),</span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">spend_person =</span> <span class="fu">unique</span>(spend_person),</span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">school_year_2017_18 =</span> <span class="fu">length</span>(year_recode[year_recode <span class="sc">==</span> <span class="st">"2017-18"</span>]),</span>
<span id="cb56-14"><a href="#cb56-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">school_year_2018_19 =</span> <span class="fu">length</span>(year_recode[year_recode <span class="sc">==</span> <span class="st">"2018-19"</span>]),</span>
<span id="cb56-15"><a href="#cb56-15" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb56-16"><a href="#cb56-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">mean_overall =</span> <span class="fu">round</span>(<span class="fu">mean</span>(overall_recode, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="dv">2</span>),</span>
<span id="cb56-17"><a href="#cb56-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">sd_overall =</span> <span class="fu">round</span>(<span class="fu">sd</span>(overall_recode, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="dv">2</span>),</span>
<span id="cb56-18"><a href="#cb56-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">median_overall =</span> <span class="fu">round</span>(<span class="fu">median</span>(overall_recode, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="dv">2</span>),</span>
<span id="cb56-19"><a href="#cb56-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">iqr_overall =</span> <span class="fu">round</span>(<span class="fu">IQR</span>(overall_recode, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="dv">2</span>),</span>
<span id="cb56-20"><a href="#cb56-20" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb56-21"><a href="#cb56-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">mean_mmr =</span> <span class="fu">round</span>(<span class="fu">mean</span>(mmr_recode, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="dv">2</span>),</span>
<span id="cb56-22"><a href="#cb56-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">sd_mmr =</span> <span class="fu">round</span>(<span class="fu">sd</span>(mmr_recode, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="dv">2</span>),</span>
<span id="cb56-23"><a href="#cb56-23" aria-hidden="true" tabindex="-1"></a>      <span class="at">median_mmr =</span> <span class="fu">round</span>(<span class="fu">median</span>(mmr_recode, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="dv">2</span>),</span>
<span id="cb56-24"><a href="#cb56-24" aria-hidden="true" tabindex="-1"></a>      <span class="at">iqr_mmr =</span> <span class="fu">round</span>(<span class="fu">IQR</span>(mmr_recode, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="dv">2</span>)</span>
<span id="cb56-25"><a href="#cb56-25" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb56-26"><a href="#cb56-26" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb56-27"><a href="#cb56-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">everything</span>(), <span class="sc">~</span> <span class="fu">replace</span>(., <span class="fu">is.na</span>(.), <span class="st">" "</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb56-28"><a href="#cb56-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-29"><a href="#cb56-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb56-30"><a href="#cb56-30" aria-hidden="true" tabindex="-1"></a>      <span class="at">mean_sd_overall =</span> <span class="fu">paste0</span>(mean_overall, <span class="st">" ("</span>, sd_overall, <span class="st">")"</span>),</span>
<span id="cb56-31"><a href="#cb56-31" aria-hidden="true" tabindex="-1"></a>      <span class="at">median_iqr_overall =</span> <span class="fu">paste0</span>(median_overall, <span class="st">" ("</span>, iqr_overall, <span class="st">")"</span>),</span>
<span id="cb56-32"><a href="#cb56-32" aria-hidden="true" tabindex="-1"></a>      <span class="at">mean_sd_mmr =</span> <span class="fu">paste0</span>(mean_mmr, <span class="st">" ("</span>, sd_mmr, <span class="st">")"</span>),</span>
<span id="cb56-33"><a href="#cb56-33" aria-hidden="true" tabindex="-1"></a>      <span class="at">median_iqr_mmr =</span> <span class="fu">paste0</span>(median_mmr, <span class="st">" ("</span>, iqr_mmr, <span class="st">")"</span>))</span>
<span id="cb56-34"><a href="#cb56-34" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb56-35"><a href="#cb56-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-36"><a href="#cb56-36" aria-hidden="true" tabindex="-1"></a>filter_mmr <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="fu">quote</span>(mmr_recode <span class="sc">!=</span> <span class="sc">-</span><span class="dv">1</span> <span class="sc">|</span> overall_recode <span class="sc">!=</span> <span class="sc">-</span><span class="dv">1</span>), </span>
<span id="cb56-37"><a href="#cb56-37" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">quote</span>(mmr_recode <span class="sc">!=</span> <span class="st">" "</span>))</span>
<span id="cb56-38"><a href="#cb56-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-39"><a href="#cb56-39" aria-hidden="true" tabindex="-1"></a>filter_overall <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="fu">quote</span>(mmr_recode <span class="sc">!=</span> <span class="sc">-</span><span class="dv">1</span> <span class="sc">|</span> overall_recode <span class="sc">!=</span> <span class="sc">-</span><span class="dv">1</span>), </span>
<span id="cb56-40"><a href="#cb56-40" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">quote</span>(overall_recode <span class="sc">!=</span> <span class="st">" "</span>))</span>
<span id="cb56-41"><a href="#cb56-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-42"><a href="#cb56-42" aria-hidden="true" tabindex="-1"></a>filter_both <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="fu">quote</span>(mmr_recode <span class="sc">!=</span> <span class="sc">-</span><span class="dv">1</span> <span class="sc">|</span> overall_recode <span class="sc">!=</span> <span class="sc">-</span><span class="dv">1</span>), </span>
<span id="cb56-43"><a href="#cb56-43" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">quote</span>(mmr_recode <span class="sc">!=</span> <span class="st">" "</span>), </span>
<span id="cb56-44"><a href="#cb56-44" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">quote</span>(overall_recode <span class="sc">!=</span> <span class="st">" "</span>))</span>
<span id="cb56-45"><a href="#cb56-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-46"><a href="#cb56-46" aria-hidden="true" tabindex="-1"></a>table_mmr <span class="ot">&lt;-</span> <span class="fu">generate_table</span>(vaccine_dat, filter_mmr)</span>
<span id="cb56-47"><a href="#cb56-47" aria-hidden="true" tabindex="-1"></a>table_overall <span class="ot">&lt;-</span> <span class="fu">generate_table</span>(vaccine_dat, filter_overall)</span>
<span id="cb56-48"><a href="#cb56-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-49"><a href="#cb56-49" aria-hidden="true" tabindex="-1"></a>table_combine <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(table_mmr, table_overall)</span>
<span id="cb56-50"><a href="#cb56-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-51"><a href="#cb56-51" aria-hidden="true" tabindex="-1"></a>table_combine <span class="sc">%&gt;%</span> </span>
<span id="cb56-52"><a href="#cb56-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(state, county_number, school_number, </span>
<span id="cb56-53"><a href="#cb56-53" aria-hidden="true" tabindex="-1"></a>         school_year_2017_18, school_year_2018_19,</span>
<span id="cb56-54"><a href="#cb56-54" aria-hidden="true" tabindex="-1"></a>         spending, spend_person, </span>
<span id="cb56-55"><a href="#cb56-55" aria-hidden="true" tabindex="-1"></a>         mean_sd_overall, median_iqr_overall, </span>
<span id="cb56-56"><a href="#cb56-56" aria-hidden="true" tabindex="-1"></a>         mean_sd_mmr, median_iqr_mmr) <span class="sc">%&gt;%</span> </span>
<span id="cb56-57"><a href="#cb56-57" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb56-58"><a href="#cb56-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">everything</span>(), <span class="sc">~</span> <span class="fu">replace</span>(., . <span class="sc">==</span> <span class="st">"  ( )"</span> <span class="sc">|</span></span>
<span id="cb56-59"><a href="#cb56-59" aria-hidden="true" tabindex="-1"></a>                                           . <span class="sc">==</span> <span class="st">"  ( - )"</span> , <span class="st">" "</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb56-60"><a href="#cb56-60" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb56-61"><a href="#cb56-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"Outcome variable"</span>,</span>
<span id="cb56-62"><a href="#cb56-62" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"Number of county report"</span>,</span>
<span id="cb56-63"><a href="#cb56-63" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"Number of school report"</span>,</span>
<span id="cb56-64"><a href="#cb56-64" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"2017 - 2018"</span>,</span>
<span id="cb56-65"><a href="#cb56-65" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"2018 - 2019"</span>,</span>
<span id="cb56-66"><a href="#cb56-66" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"Per state"</span>, <span class="st">"Per person"</span>, </span>
<span id="cb56-67"><a href="#cb56-67" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"Mean (SD)"</span>, <span class="st">"Median (IQR)"</span>,</span>
<span id="cb56-68"><a href="#cb56-68" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"Mean (SD)"</span>, <span class="st">"Median (IQR)"</span>),</span>
<span id="cb56-69"><a href="#cb56-69" aria-hidden="true" tabindex="-1"></a>        <span class="at">format =</span> <span class="st">"html"</span>, <span class="at">escape =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb56-70"><a href="#cb56-70" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb56-71"><a href="#cb56-71" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_rows</span>(<span class="st">"MMR (N = 21)"</span>, <span class="dv">1</span>, <span class="fu">nrow</span>(table_mmr)) <span class="sc">%&gt;%</span> </span>
<span id="cb56-72"><a href="#cb56-72" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_rows</span>(<span class="st">"Overall (N = 17)"</span>, </span>
<span id="cb56-73"><a href="#cb56-73" aria-hidden="true" tabindex="-1"></a>             <span class="fu">nrow</span>(table_mmr) <span class="sc">+</span> <span class="dv">1</span>, </span>
<span id="cb56-74"><a href="#cb56-74" aria-hidden="true" tabindex="-1"></a>             <span class="fu">nrow</span>(table_mmr) <span class="sc">+</span> </span>
<span id="cb56-75"><a href="#cb56-75" aria-hidden="true" tabindex="-1"></a>             <span class="fu">nrow</span>(table_overall)) <span class="sc">%&gt;%</span> </span>
<span id="cb56-76"><a href="#cb56-76" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb56-77"><a href="#cb56-77" aria-hidden="true" tabindex="-1"></a><span class="fu">add_header_above</span>(<span class="fu">c</span>(<span class="st">" "</span> <span class="ot">=</span> <span class="dv">1</span>, <span class="st">" "</span> <span class="ot">=</span> <span class="dv">2</span>, <span class="st">"School year"</span> <span class="ot">=</span> <span class="dv">2</span>,</span>
<span id="cb56-78"><a href="#cb56-78" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"State spending in US$ (millions)"</span> <span class="ot">=</span> <span class="dv">2</span>,</span>
<span id="cb56-79"><a href="#cb56-79" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"Overall Vaccination Rate"</span> <span class="ot">=</span> <span class="dv">2</span>, <span class="st">"MMR Vaccination Rate"</span> <span class="ot">=</span> <span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<caption>Table A1. Summary Statistics of Variables in Analytical Dataset by State and Outcome</caption>
<colgroup>
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 9%">
</colgroup>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" style="empty-cells: hide; border-bottom: hidden"></th>
<th colspan="2" data-quarto-table-cell-role="th" style="empty-cells: hide; border-bottom: hidden"></th>
<th colspan="2" data-quarto-table-cell-role="th" style="text-align: center; border-bottom: hidden; padding-bottom: 0; padding-left: 3px; padding-right: 3px;"><div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
School year
</div></th>
<th colspan="2" data-quarto-table-cell-role="th" style="text-align: center; border-bottom: hidden; padding-bottom: 0; padding-left: 3px; padding-right: 3px;"><div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
State spending in US$ (millions)
</div></th>
<th colspan="2" data-quarto-table-cell-role="th" style="text-align: center; border-bottom: hidden; padding-bottom: 0; padding-left: 3px; padding-right: 3px;"><div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Overall Vaccination Rate
</div></th>
<th colspan="2" data-quarto-table-cell-role="th" style="text-align: center; border-bottom: hidden; padding-bottom: 0; padding-left: 3px; padding-right: 3px;"><div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
MMR Vaccination Rate
</div></th>
</tr>
<tr class="odd">
<th style="text-align: left;" data-quarto-table-cell-role="th">Outcome variable</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Number of county report</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Number of school report</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">2017 - 2018</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">2018 - 2019</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Per state</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Per person</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Mean (SD)</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Median (IQR)</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Mean (SD)</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Median (IQR)</th>
</tr>
</thead>
<tbody>
<tr class="odd" data-grouplength="21">
<td colspan="11" style="border-bottom: 1px solid"><strong>MMR (N = 21)</strong></td>
</tr>
<tr class="even">
<td style="text-align: left; padding-left: 2em;" data-indentlevel="1">ARIZONA</td>
<td style="text-align: left;">15</td>
<td style="text-align: left;">1073</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">1073</td>
<td style="text-align: left;">7137123</td>
<td style="text-align: left;">5.95</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">92.7 (8.7)</td>
<td style="text-align: left;">95 (7.01)</td>
</tr>
<tr class="odd">
<td style="text-align: left; padding-left: 2em;" data-indentlevel="1">ARKANSAS</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">481</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">481</td>
<td style="text-align: left;">4411761</td>
<td style="text-align: left;">8.57</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">80.52 (8.38)</td>
<td style="text-align: left;">82.2 (9.7)</td>
</tr>
<tr class="even">
<td style="text-align: left; padding-left: 2em;" data-indentlevel="1">CALIFORNIA</td>
<td style="text-align: left;">57</td>
<td style="text-align: left;">6523</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">6523</td>
<td style="text-align: left;">68892072</td>
<td style="text-align: left;">10.44</td>
<td style="text-align: left;">94.19 (8.79)</td>
<td style="text-align: left;">96 (3)</td>
<td style="text-align: left;">95.59 (7.29)</td>
<td style="text-align: left;">98 (3)</td>
</tr>
<tr class="odd">
<td style="text-align: left; padding-left: 2em;" data-indentlevel="1">COLORADO</td>
<td style="text-align: left;">64</td>
<td style="text-align: left;">1317</td>
<td style="text-align: left;">1317</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">8060420</td>
<td style="text-align: left;">8.69</td>
<td style="text-align: left;">87.97 (12.59)</td>
<td style="text-align: left;">91.3 (11.78)</td>
<td style="text-align: left;">94.42 (8.72)</td>
<td style="text-align: left;">98.11 (8.33)</td>
</tr>
<tr class="even">
<td style="text-align: left; padding-left: 2em;" data-indentlevel="1">CONNECTICUT</td>
<td style="text-align: left;">8</td>
<td style="text-align: left;">554</td>
<td style="text-align: left;">554</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">8687640</td>
<td style="text-align: left;">15.3</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">96.77 (4.34)</td>
<td style="text-align: left;">97.86 (4.17)</td>
</tr>
<tr class="odd">
<td style="text-align: left; padding-left: 2em;" data-indentlevel="1">ILLINOIS</td>
<td style="text-align: left;">102</td>
<td style="text-align: left;">3574</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">3574</td>
<td style="text-align: left;">23933484</td>
<td style="text-align: left;">11.12</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">97.07 (4.64)</td>
<td style="text-align: left;">98.18 (2.52)</td>
</tr>
<tr class="even">
<td style="text-align: left; padding-left: 2em;" data-indentlevel="1">MAINE</td>
<td style="text-align: left;">16</td>
<td style="text-align: left;">353</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">353</td>
<td style="text-align: left;">2290535</td>
<td style="text-align: left;">12.06</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">92.55 (8.97)</td>
<td style="text-align: left;">94.74 (8.24)</td>
</tr>
<tr class="odd">
<td style="text-align: left; padding-left: 2em;" data-indentlevel="1">MASSACHUSETTS</td>
<td style="text-align: left;">14</td>
<td style="text-align: left;">827</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">827</td>
<td style="text-align: left;">13998163</td>
<td style="text-align: left;">13.78</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">96.92 (6.3)</td>
<td style="text-align: left;">99 (3)</td>
</tr>
<tr class="even">
<td style="text-align: left; padding-left: 2em;" data-indentlevel="1">MINNESOTA</td>
<td style="text-align: left;">87</td>
<td style="text-align: left;">1112</td>
<td style="text-align: left;">1112</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">9987116</td>
<td style="text-align: left;">10.62</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">90.27 (11.57)</td>
<td style="text-align: left;">93.92 (9.53)</td>
</tr>
<tr class="odd">
<td style="text-align: left; padding-left: 2em;" data-indentlevel="1">MISSOURI</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">441</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">441</td>
<td style="text-align: left;">8996869</td>
<td style="text-align: left;">8.89</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">91.14 (12.8)</td>
<td style="text-align: left;">96 (8.6)</td>
</tr>
<tr class="even">
<td style="text-align: left; padding-left: 2em;" data-indentlevel="1">MONTANA</td>
<td style="text-align: left;">55</td>
<td style="text-align: left;">448</td>
<td style="text-align: left;">448</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">1598517</td>
<td style="text-align: left;">9.69</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">93.87 (10.42)</td>
<td style="text-align: left;">97.15 (5.72)</td>
</tr>
<tr class="odd">
<td style="text-align: left; padding-left: 2em;" data-indentlevel="1">NEW YORK</td>
<td style="text-align: left;">62</td>
<td style="text-align: left;">3562</td>
<td style="text-align: left;">3562</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">56656536</td>
<td style="text-align: left;">19</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">95.94 (10.9)</td>
<td style="text-align: left;">99 (2.3)</td>
</tr>
<tr class="even">
<td style="text-align: left; padding-left: 2em;" data-indentlevel="1">NORTH DAKOTA</td>
<td style="text-align: left;">51</td>
<td style="text-align: left;">266</td>
<td style="text-align: left;">266</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">1393844</td>
<td style="text-align: left;">11.52</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">92.84 (10.02)</td>
<td style="text-align: left;">95.39 (8.9)</td>
</tr>
<tr class="odd">
<td style="text-align: left; padding-left: 2em;" data-indentlevel="1">OHIO</td>
<td style="text-align: left;">88</td>
<td style="text-align: left;">1988</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">1988</td>
<td style="text-align: left;">20271944</td>
<td style="text-align: left;">10.56</td>
<td style="text-align: left;">87.85 (14.29)</td>
<td style="text-align: left;">92.86 (10.84)</td>
<td style="text-align: left;">90.37 (12.66)</td>
<td style="text-align: left;">94.63 (8.98)</td>
</tr>
<tr class="even">
<td style="text-align: left; padding-left: 2em;" data-indentlevel="1">OREGON</td>
<td style="text-align: left;">36</td>
<td style="text-align: left;">723</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">723</td>
<td style="text-align: left;">6285584</td>
<td style="text-align: left;">9.87</td>
<td style="text-align: left;">91.28 (7.71)</td>
<td style="text-align: left;">93.4 (4.88)</td>
<td style="text-align: left;">93.91 (6.34)</td>
<td style="text-align: left;">95.55 (3.83)</td>
</tr>
<tr class="odd">
<td style="text-align: left; padding-left: 2em;" data-indentlevel="1">PENNSYLVANIA</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">1635</td>
<td style="text-align: left;">1635</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">25955384</td>
<td style="text-align: left;">13.21</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">96.83 (4.51)</td>
<td style="text-align: left;">97.9 (4)</td>
</tr>
<tr class="even">
<td style="text-align: left; padding-left: 2em;" data-indentlevel="1">SOUTH DAKOTA</td>
<td style="text-align: left;">65</td>
<td style="text-align: left;">363</td>
<td style="text-align: left;">363</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">1185796</td>
<td style="text-align: left;">7.8</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">95.03 (9.92)</td>
<td style="text-align: left;">100 (5.47)</td>
</tr>
<tr class="odd">
<td style="text-align: left; padding-left: 2em;" data-indentlevel="1">TEXAS</td>
<td style="text-align: left;">93</td>
<td style="text-align: left;">777</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">777</td>
<td style="text-align: left;">43287224</td>
<td style="text-align: left;">8.15</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">93.11 (10.66)</td>
<td style="text-align: left;">97.92 (9.68)</td>
</tr>
<tr class="even">
<td style="text-align: left; padding-left: 2em;" data-indentlevel="1">UTAH</td>
<td style="text-align: left;">29</td>
<td style="text-align: left;">601</td>
<td style="text-align: left;">601</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">3931265</td>
<td style="text-align: left;">5.89</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">95.2 (5.4)</td>
<td style="text-align: left;">96.34 (3.66)</td>
</tr>
<tr class="odd">
<td style="text-align: left; padding-left: 2em;" data-indentlevel="1">VERMONT</td>
<td style="text-align: left;">14</td>
<td style="text-align: left;">338</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">338</td>
<td style="text-align: left;">1536843</td>
<td style="text-align: left;">17.46</td>
<td style="text-align: left;">91.58 (10.91)</td>
<td style="text-align: left;">94.78 (6.95)</td>
<td style="text-align: left;">94.58 (8.64)</td>
<td style="text-align: left;">97.22 (5.11)</td>
</tr>
<tr class="even">
<td style="text-align: left; padding-left: 2em;" data-indentlevel="1">WASHINGTON</td>
<td style="text-align: left;">38</td>
<td style="text-align: left;">1368</td>
<td style="text-align: left;">1368</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">12315163</td>
<td style="text-align: left;">10.43</td>
<td style="text-align: left;">83.7 (15.23)</td>
<td style="text-align: left;">87.76 (13.86)</td>
<td style="text-align: left;">88.64 (12.59)</td>
<td style="text-align: left;">92.16 (10.17)</td>
</tr>
<tr class="odd" data-grouplength="17">
<td colspan="11" style="border-bottom: 1px solid"><strong>Overall (N = 17)</strong></td>
</tr>
<tr class="even">
<td style="text-align: left; padding-left: 2em;" data-indentlevel="1">CALIFORNIA</td>
<td style="text-align: left;">57</td>
<td style="text-align: left;">6522</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">6522</td>
<td style="text-align: left;">68892072</td>
<td style="text-align: left;">10.44</td>
<td style="text-align: left;">94.19 (8.79)</td>
<td style="text-align: left;">96 (3)</td>
<td style="text-align: left;">95.6 (7.2)</td>
<td style="text-align: left;">98 (3)</td>
</tr>
<tr class="odd">
<td style="text-align: left; padding-left: 2em;" data-indentlevel="1">COLORADO</td>
<td style="text-align: left;">64</td>
<td style="text-align: left;">1315</td>
<td style="text-align: left;">1315</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">8060420</td>
<td style="text-align: left;">8.69</td>
<td style="text-align: left;">87.97 (12.59)</td>
<td style="text-align: left;">91.3 (11.78)</td>
<td style="text-align: left;">94.41 (8.72)</td>
<td style="text-align: left;">98.11 (8.33)</td>
</tr>
<tr class="even">
<td style="text-align: left; padding-left: 2em;" data-indentlevel="1">FLORIDA</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">2236</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">2236</td>
<td style="text-align: left;">24222830</td>
<td style="text-align: left;">7.98</td>
<td style="text-align: left;">92.53 (8.67)</td>
<td style="text-align: left;">94.37 (5.34)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left; padding-left: 2em;" data-indentlevel="1">IDAHO</td>
<td style="text-align: left;">44</td>
<td style="text-align: left;">467</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">467</td>
<td style="text-align: left;">1935653</td>
<td style="text-align: left;">5.99</td>
<td style="text-align: left;">82.44 (15.59)</td>
<td style="text-align: left;">86.67 (14.1)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left; padding-left: 2em;" data-indentlevel="1">IOWA</td>
<td style="text-align: left;">99</td>
<td style="text-align: left;">783</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">783</td>
<td style="text-align: left;">5517359</td>
<td style="text-align: left;">10.35</td>
<td style="text-align: left;">95.81 (4.73)</td>
<td style="text-align: left;">96.9 (2.8)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left; padding-left: 2em;" data-indentlevel="1">MICHIGAN</td>
<td style="text-align: left;">83</td>
<td style="text-align: left;">1899</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">1899</td>
<td style="text-align: left;">15328155</td>
<td style="text-align: left;">9.46</td>
<td style="text-align: left;">92.12 (6.81)</td>
<td style="text-align: left;">93.5 (6.05)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left; padding-left: 2em;" data-indentlevel="1">NEW JERSEY</td>
<td style="text-align: left;">21</td>
<td style="text-align: left;">1982</td>
<td style="text-align: left;">1982</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">24349836</td>
<td style="text-align: left;">16.78</td>
<td style="text-align: left;">95.31 (8.19)</td>
<td style="text-align: left;">97.8 (5.6)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left; padding-left: 2em;" data-indentlevel="1">NORTH CAROLINA</td>
<td style="text-align: left;">100</td>
<td style="text-align: left;">1766</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">1766</td>
<td style="text-align: left;">12620939</td>
<td style="text-align: left;">7.47</td>
<td style="text-align: left;">96.79 (7.52)</td>
<td style="text-align: left;">100 (3)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left; padding-left: 2em;" data-indentlevel="1">OHIO</td>
<td style="text-align: left;">88</td>
<td style="text-align: left;">1986</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">1986</td>
<td style="text-align: left;">20271944</td>
<td style="text-align: left;">10.56</td>
<td style="text-align: left;">87.85 (14.29)</td>
<td style="text-align: left;">92.86 (10.84)</td>
<td style="text-align: left;">90.44 (12.42)</td>
<td style="text-align: left;">94.64 (8.89)</td>
</tr>
<tr class="odd">
<td style="text-align: left; padding-left: 2em;" data-indentlevel="1">OKLAHOMA</td>
<td style="text-align: left;">77</td>
<td style="text-align: left;">794</td>
<td style="text-align: left;">794</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">4958496</td>
<td style="text-align: left;">7.11</td>
<td style="text-align: left;">90.89 (9.86)</td>
<td style="text-align: left;">94 (10)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left; padding-left: 2em;" data-indentlevel="1">OREGON</td>
<td style="text-align: left;">36</td>
<td style="text-align: left;">723</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">723</td>
<td style="text-align: left;">6285584</td>
<td style="text-align: left;">9.87</td>
<td style="text-align: left;">91.28 (7.71)</td>
<td style="text-align: left;">93.4 (4.88)</td>
<td style="text-align: left;">93.91 (6.34)</td>
<td style="text-align: left;">95.55 (3.83)</td>
</tr>
<tr class="odd">
<td style="text-align: left; padding-left: 2em;" data-indentlevel="1">RHODE ISLAND</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">215</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">215</td>
<td style="text-align: left;">2297516</td>
<td style="text-align: left;">14.92</td>
<td style="text-align: left;">94.87 (9.02)</td>
<td style="text-align: left;">97.4 (6.7)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left; padding-left: 2em;" data-indentlevel="1">TENNESSEE</td>
<td style="text-align: left;">95</td>
<td style="text-align: left;">1004</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">1004</td>
<td style="text-align: left;">8294165</td>
<td style="text-align: left;">7.55</td>
<td style="text-align: left;">94.95 (4.44)</td>
<td style="text-align: left;">95.8 (4.9)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left; padding-left: 2em;" data-indentlevel="1">VERMONT</td>
<td style="text-align: left;">14</td>
<td style="text-align: left;">338</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">338</td>
<td style="text-align: left;">1536843</td>
<td style="text-align: left;">17.46</td>
<td style="text-align: left;">91.58 (10.91)</td>
<td style="text-align: left;">94.78 (6.95)</td>
<td style="text-align: left;">94.58 (8.64)</td>
<td style="text-align: left;">97.22 (5.11)</td>
</tr>
<tr class="even">
<td style="text-align: left; padding-left: 2em;" data-indentlevel="1">VIRGINIA</td>
<td style="text-align: left;">130</td>
<td style="text-align: left;">1413</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">1413</td>
<td style="text-align: left;">14385736</td>
<td style="text-align: left;">10.59</td>
<td style="text-align: left;">93.8 (8.16)</td>
<td style="text-align: left;">95.9 (6.9)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left; padding-left: 2em;" data-indentlevel="1">WASHINGTON</td>
<td style="text-align: left;">38</td>
<td style="text-align: left;">1368</td>
<td style="text-align: left;">1368</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">12315163</td>
<td style="text-align: left;">10.43</td>
<td style="text-align: left;">83.7 (15.23)</td>
<td style="text-align: left;">87.76 (13.86)</td>
<td style="text-align: left;">88.64 (12.59)</td>
<td style="text-align: left;">92.16 (10.17)</td>
</tr>
<tr class="even">
<td style="text-align: left; padding-left: 2em;" data-indentlevel="1">WISCONSIN</td>
<td style="text-align: left;">72</td>
<td style="text-align: left;">1423</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">1423</td>
<td style="text-align: left;">9691073</td>
<td style="text-align: left;">10.18</td>
<td style="text-align: left;">85.81 (12.45)</td>
<td style="text-align: left;">90 (12)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
</tbody>
</table>


</div>
</div>
</section>
<section id="supplementary-table-a2-aic-and-bic-to-compare-models" class="level3">
<h3 class="anchored" data-anchor-id="supplementary-table-a2-aic-and-bic-to-compare-models">Supplementary Table A2: AIC and BIC to compare models</h3>
<p>Combine overall vaccination and MMR vaccination AIC and BIC tables</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>info_criterion <span class="ot">&lt;-</span> <span class="fu">rbind</span>(info_crit_table, info_crit_table_mmr) <span class="sc">%&gt;%</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Outcome, Model, AIC, BIC) <span class="sc">%&gt;%</span></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># make it pretty</span></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">kable</span>(<span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"Outcome"</span>,</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>                        <span class="st">"Model"</span>,</span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>                        <span class="st">"AIC"</span>,</span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"BIC"</span>),</span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">format =</span> <span class="st">"html"</span>, <span class="at">escape =</span> <span class="cn">FALSE</span>) </span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a>info_criterion</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<caption>Table A2. AIC and BIC to compare models</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Outcome</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Model</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">AIC</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">BIC</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Overall vaccination rate</td>
<td style="text-align: left;">Three-level</td>
<td style="text-align: right;">176070.2</td>
<td style="text-align: right;">176134.8</td>
</tr>
<tr class="even">
<td style="text-align: left;">Overall vaccination rate</td>
<td style="text-align: left;">Two-level</td>
<td style="text-align: right;">194788.1</td>
<td style="text-align: right;">194845.3</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Overall vaccination rate</td>
<td style="text-align: left;">Base model</td>
<td style="text-align: right;">197626.5</td>
<td style="text-align: right;">197675.6</td>
</tr>
<tr class="even">
<td style="text-align: left;">MMR vaccination rate</td>
<td style="text-align: left;">Three-level</td>
<td style="text-align: right;">184021.8</td>
<td style="text-align: right;">184087.0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">MMR vaccination rate</td>
<td style="text-align: left;">Two-level</td>
<td style="text-align: right;">203694.6</td>
<td style="text-align: right;">203752.4</td>
</tr>
<tr class="even">
<td style="text-align: left;">MMR vaccination rate</td>
<td style="text-align: left;">Base model</td>
<td style="text-align: right;">205814.8</td>
<td style="text-align: right;">205864.3</td>
</tr>
</tbody>
</table>


</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>tictoc<span class="sc">::</span><span class="fu">toc</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>75.574 sec elapsed</code></pre>
</div>
</div>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>